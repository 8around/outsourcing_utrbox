# 003_ì¶”ê°€_ìŠ¤í‚¤ë§ˆ_ìµœì í™”_ë¶„ì„

## ğŸ“Œ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-23
- **ë¶„ì„ ëŒ€ìƒ**: DATABASE_SCHEMA.md (2ì°¨ ìµœì í™”)
- **ëª©ì **: ì¶”ê°€ ìš”êµ¬ì‚¬í•­ ë°˜ì˜ ë° analysis_results í…Œì´ë¸” ì¬êµ¬ì¡°í™”

---

## ğŸ“‹ ëª©ì°¨
1. [ì¶”ê°€ ìµœì í™” ìš”êµ¬ì‚¬í•­](#ì¶”ê°€-ìµœì í™”-ìš”êµ¬ì‚¬í•­)
2. [ë³€ê²½ì‚¬í•­ ë¶„ì„](#ë³€ê²½ì‚¬í•­-ë¶„ì„)
3. [analysis_results ì¬êµ¬ì¡°í™”](#analysis_results-ì¬êµ¬ì¡°í™”)
4. [ìµœì¢… ìŠ¤í‚¤ë§ˆ êµ¬ì¡°](#ìµœì¢…-ìŠ¤í‚¤ë§ˆ-êµ¬ì¡°)
5. [ìš°ë ¤ì‚¬í•­ ë° ê¶Œì¥ì‚¬í•­](#ìš°ë ¤ì‚¬í•­-ë°-ê¶Œì¥ì‚¬í•­)

---

## ì¶”ê°€ ìµœì í™” ìš”êµ¬ì‚¬í•­

### 1. ì „ì—­ ë³€ê²½
- âŒ **similarity_score ì œê±°**: Google Vision APIì—ì„œ deprecatedë¨

### 2. contents í…Œì´ë¸”
- âŒ **file_size ì œê±°**: Supabase Storageì—ì„œ ê´€ë¦¬
- âŒ **mime_type ì œê±°**: Supabase Storageì—ì„œ ê´€ë¦¬
- ğŸ”„ **status â†’ is_analyzed**: BOOLEAN íƒ€ì…ìœ¼ë¡œ ë³€ê²½
  - `NULL`: ë¶„ì„ ëŒ€ê¸°
  - `FALSE`: ë¶„ì„ ì¤‘
  - `TRUE`: ë¶„ì„ ì™„ë£Œ
- âŒ **match_count ì œê±°**: JOINìœ¼ë¡œ ì‹¤ì‹œê°„ ê³„ì‚°

### 3. analysis_results í…Œì´ë¸”
- ğŸ”„ **ì¬êµ¬ì¡°í™”**: label, text ë°ì´í„°ë¥¼ contentsë¡œ ì´ë™
- âŒ **í…Œì´ë¸” ì‚­ì œ ê²€í† **: í•„ìš”ì„± ì¬í‰ê°€

---

## ë³€ê²½ì‚¬í•­ ë¶„ì„

### âœ… 1. similarity_score ì œê±°

**í˜„ì¬ ìœ„ì¹˜:**
```sql
detected_contents.similarity_score DECIMAL(5,4)
```

**ì œê±° ê·¼ê±°:**
- Google Vision APIì—ì„œ deprecated
- PRDì— ìœ ì‚¬ë„ ì ìˆ˜ í‘œì‹œ ìš”êµ¬ì‚¬í•­ ì—†ìŒ
- `detection_type` (full_match/partial_match/visually_similar)ë§Œìœ¼ë¡œë„ ì¶©ë¶„

**ì˜í–¥:**
- ì¸ë±ìŠ¤ ì‚­ì œ: `idx_detected_contents_similarity`
- RLS ì •ì±… ì˜í–¥ ì—†ìŒ
- ì¿¼ë¦¬ ì˜í–¥ ì—†ìŒ

**ê²°ë¡ :** âœ… **ì œê±° ìŠ¹ì¸**

---

### ğŸŸ¡ 2. file_size ì œê±°

**í˜„ì¬ ìš©ë„:**
```sql
file_size INTEGER NOT NULL CHECK (file_size > 0)
```

**ì œê±° ì‹œ ê³ ë ¤ì‚¬í•­:**

#### ì¥ì 
- Supabase Storageì— ì´ë¯¸ íŒŒì¼ í¬ê¸° ì •ë³´ ì¡´ì¬
- ë°ì´í„° ì¤‘ë³µ ì œê±°

#### ìš°ë ¤ì‚¬í•­
1. **íŒŒì¼ í¬ê¸° ì œí•œ ê²€ì¦**
   - í˜„ì¬: `CHECK (file_size > 0)` ì œì•½
   - ì‚­ì œ í›„: Supabase Storage ì •ì±…ìœ¼ë¡œ ì´ë™ í•„ìš”

2. **ì¡°íšŒ ì„±ëŠ¥**
   - í˜„ì¬: DBì—ì„œ ì§ì ‘ ì¡°íšŒ
   - ì‚­ì œ í›„: Storage API í˜¸ì¶œ í•„ìš” (ëŠë¦¼)

#### ê¶Œì¥ì‚¬í•­
**ì¡°ê±´ë¶€ ì œê±°:**
- âœ… íŒŒì¼ í¬ê¸° ì •ë³´ê°€ UIì— í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ â†’ ì œê±°
- âŒ íŒŒì¼ í¬ê¸°ë¥¼ ìì£¼ ì¡°íšŒí•˜ë©´ â†’ ìœ ì§€

**ëŒ€ì•ˆ:**
```sql
-- ìµœì†Œí•œì˜ ì •ë³´ë§Œ ìœ ì§€
file_size_bytes BIGINT  -- í†µê³„ ëª©ì ìœ¼ë¡œë§Œ
```

**ì§ˆë¬¸:** ì‚¬ìš©ì/ê´€ë¦¬ì í™”ë©´ì—ì„œ íŒŒì¼ í¬ê¸°ë¥¼ í‘œì‹œí•  ì˜ˆì •ì¸ê°€ìš”?

---

### ğŸŸ¡ 3. mime_type ì œê±°

**í˜„ì¬ ìš©ë„:**
```sql
mime_type TEXT NOT NULL CHECK (mime_type IN ('image/jpeg', 'image/png'))
```

**ì œê±° ì‹œ ê³ ë ¤ì‚¬í•­:**

#### ìš°ë ¤ì‚¬í•­
1. **íŒŒì¼ íƒ€ì… ê²€ì¦**
   - í˜„ì¬: DB CHECK ì œì•½ìœ¼ë¡œ jpg/pngë§Œ í—ˆìš©
   - ì‚­ì œ í›„: í´ë¼ì´ì–¸íŠ¸ ë˜ëŠ” Storage ì •ì±…ìœ¼ë¡œ ì´ë™

2. **Google Vision API í˜¸ì¶œ**
   - APIëŠ” ì´ë¯¸ì§€ íƒ€ì…ì— ë”°ë¼ ì²˜ë¦¬ ë°©ë²•ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
   - mime_type ì—†ì´ í˜¸ì¶œ ì‹œ Storage ë©”íƒ€ë°ì´í„° ì¡°íšŒ í•„ìš” (ì¶”ê°€ API í˜¸ì¶œ)

#### ê¶Œì¥ì‚¬í•­
**ì¡°ê±´ë¶€ ì œê±°:**
- âœ… Supabase Storageì—ì„œ mime-type ì‰½ê²Œ ì¡°íšŒ ê°€ëŠ¥ â†’ ì œê±°
- âŒ API í˜¸ì¶œë§ˆë‹¤ Storage ì¡°íšŒê°€ ë¶€ë‹´ìŠ¤ëŸ¬ì›€ â†’ ìœ ì§€

**ëŒ€ì•ˆ:**
```sql
-- ê²€ì¦ ì—†ì´ ì €ì¥ë§Œ
mime_type TEXT  -- CHECK ì œì•½ ì œê±°, ì°¸ê³ ìš©ìœ¼ë¡œë§Œ
```

**ì§ˆë¬¸:** Google Vision API í˜¸ì¶œ ì‹œ mime-typeì´ í•„ìˆ˜ì¸ê°€ìš”?

---

### ğŸ”´ 4. status â†’ is_analyzed ë³€ê²½

**í˜„ì¬:**
```sql
status TEXT CHECK (status IN ('pending', 'analyzing', 'analyzed', 'error'))
```

**ì œì•ˆ:**
```sql
is_analyzed BOOLEAN  -- NULL(ëŒ€ê¸°), FALSE(ë¶„ì„ì¤‘), TRUE(ì™„ë£Œ)
```

**ë¬¸ì œì  ë°œê²¬:**
âŒ **ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬ ë¶ˆê°€**

| ìƒíƒœ | í˜„ì¬ (TEXT) | ì œì•ˆ (BOOLEAN) |
|------|-------------|----------------|
| ëŒ€ê¸° | 'pending' | NULL |
| ë¶„ì„ì¤‘ | 'analyzing' | FALSE |
| ì™„ë£Œ | 'analyzed' | TRUE |
| **ì‹¤íŒ¨** | **'error'** | **??? (ë¶ˆê°€ëŠ¥)** |

#### í•´ê²° ë°©ì•ˆ

**ë°©ì•ˆ A: is_analyzed + error_message ì¡°í•©**
```sql
is_analyzed BOOLEAN,
error_message TEXT

-- ìƒíƒœ êµ¬ë¶„:
-- NULL + NULL = ëŒ€ê¸°
-- FALSE + NULL = ë¶„ì„ì¤‘
-- TRUE + NULL = ì™„ë£Œ
-- FALSE + "ì—ëŸ¬ë©”ì‹œì§€" = ì‹¤íŒ¨
```

âœ… **ì¥ì :** ì—ëŸ¬ ë©”ì‹œì§€ë„ í•¨ê»˜ ì €ì¥
âŒ **ë‹¨ì :** ë‘ ì»¬ëŸ¼ ì¡°í•©ìœ¼ë¡œ ìƒíƒœ íŒë‹¨ (ë³µì¡)

**ë°©ì•ˆ B: 3-value ìƒíƒœ ìœ ì§€**
```sql
-- BOOLEAN ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°„ì†Œí™”ëœ TEXT
status TEXT CHECK (status IN ('pending', 'processing', 'completed'))
-- ì—ëŸ¬ëŠ” error_message ì¡´ì¬ ì—¬ë¶€ë¡œ íŒë‹¨
```

**ë°©ì•ˆ C: is_analyzedë§Œ ì‚¬ìš© (ì—ëŸ¬ êµ¬ë¶„ ì•ˆí•¨)**
```sql
is_analyzed BOOLEAN  -- NULL, FALSE, TRUE
-- ì—ëŸ¬ëŠ” FALSE ìƒíƒœë¡œ ìœ ì§€, UIì—ì„œ ì¬ì‹œë„ ê°€ëŠ¥í•˜ê²Œ
```

#### ê¶Œì¥ì‚¬í•­
ğŸ”´ **ë°©ì•ˆ A ê¶Œì¥** (is_analyzed + error_message)
- ì—ëŸ¬ ìƒíƒœ ëª…í™•íˆ êµ¬ë¶„
- ë””ë²„ê¹… ê°€ëŠ¥
- NULL/FALSE êµ¬ë¶„ìœ¼ë¡œ "ëŒ€ê¸°"ì™€ "ë¶„ì„ì¤‘/ì‹¤íŒ¨" êµ¬ë¶„

---

### âœ… 5. match_count ì œê±°

**í˜„ì¬:**
```sql
match_count INTEGER DEFAULT 0  -- íŠ¸ë¦¬ê±°ë¡œ ìë™ ì—…ë°ì´íŠ¸
```

**ì œê±° í›„:**
```sql
-- detected_contents JOINìœ¼ë¡œ ê³„ì‚°
SELECT
  c.id,
  c.file_name,
  COUNT(dc.id) FILTER (WHERE dc.admin_review_status = 'match') as match_count
FROM contents c
LEFT JOIN detected_contents dc ON dc.content_id = c.id
WHERE c.user_id = ?
GROUP BY c.id;
```

**ì¥ì :**
- ë°ì´í„° ì¤‘ë³µ ì œê±°
- íŠ¸ë¦¬ê±° ë¶ˆí•„ìš” (`update_content_detection_count` ì‚­ì œ)
- í•­ìƒ ì •í™•í•œ ê°’

**ì„±ëŠ¥:**
- ì¸ë±ìŠ¤ í™œìš©: `idx_detected_contents_content_status`
- ì˜ˆìƒ ì‹¤í–‰ ì‹œê°„: 5-20ms (ì¸ë±ìŠ¤ ìˆì„ ë•Œ)

**ê²°ë¡ :** âœ… **ì œê±° ìŠ¹ì¸**

---

## analysis_results ì¬êµ¬ì¡°í™”

### í˜„ì¬ êµ¬ì¡°

```sql
-- analysis_results í…Œì´ë¸”
CREATE TABLE public.analysis_results (
  id UUID PRIMARY KEY,
  content_id UUID REFERENCES contents(id),
  analysis_type TEXT CHECK (analysis_type IN ('label', 'text', 'web')),
  raw_response JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE
);

-- ì‚¬ìš© ë°©ì‹:
-- 1ê°œ content â†’ 3ê°œ analysis_results (label, text, web)
```

### ì œì•ˆ êµ¬ì¡°

```sql
-- contents í…Œì´ë¸”ì— í†µí•©
CREATE TABLE public.contents (
  id UUID PRIMARY KEY,
  -- ... ê¸°ì¡´ ì»¬ëŸ¼ë“¤ ...

  -- AI ë¶„ì„ ê²°ê³¼ ì§ì ‘ ì €ì¥
  label_data JSONB,  -- LABEL_DETECTION ì›ë³¸ ì‘ë‹µ
  text_data JSONB,   -- TEXT_DETECTION ì›ë³¸ ì‘ë‹µ

  -- WEB_DETECTIONì€ detected_contents í…Œì´ë¸”ì— ì €ì¥
);

-- analysis_results í…Œì´ë¸” ì‚­ì œ
```

### íƒ€ë‹¹ì„± ë¶„ì„

#### âœ… ì¥ì 

1. **í…Œì´ë¸” ê°„ì†Œí™”**
   - 5ê°œ â†’ 4ê°œ í…Œì´ë¸” (20% ê°ì†Œ)

2. **ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ**
   - í˜„ì¬: `contents JOIN analysis_results` í•„ìš”
   - ì œì•ˆ: `contents` ë‹¨ì¼ ì¡°íšŒ

3. **1:1 ê´€ê³„ ì í•©**
   - 1ê°œ content = 1ê°œ label_data + 1ê°œ text_data
   - JSONBë¡œ ì €ì¥ ì í•©

4. **JSONB í¬ê¸° ì ì •**
   - LABEL_DETECTION: ~5-10KB
   - TEXT_DETECTION: ~1-50KB
   - ì´ ~10-60KB per content (PostgreSQL JSONB ìµœëŒ€ 1GB, ì¶©ë¶„í•¨)

#### ğŸŸ¡ ìš°ë ¤ì‚¬í•­

1. **ì¬ë¶„ì„ ì´ë ¥ ê´€ë¦¬**
   - í˜„ì¬: `analysis_results.created_at`ìœ¼ë¡œ ë¶„ì„ ì´ë ¥ ì¶”ì  ê°€ëŠ¥
   - ì œì•ˆ: ë®ì–´ì“°ê¸°ë§Œ ê°€ëŠ¥ (ì´ë ¥ ì—†ìŒ)

   **í‰ê°€:** PRDì— ë¶„ì„ ì´ë ¥ ì¶”ì  ìš”êµ¬ì‚¬í•­ ì—†ìŒ â†’ ë¬¸ì œ ì—†ìŒ

2. **Google API ì›ë³¸ ì‘ë‹µ ë³´ì¡´**
   - í˜„ì¬: `raw_response` JSONBë¡œ ì›ë³¸ ë³´ì¡´
   - ì œì•ˆ: `label_data`, `text_data`ì— ë™ì¼í•˜ê²Œ ì›ë³¸ ì €ì¥

   **í‰ê°€:** ê¸°ëŠ¥ ë™ì¼ â†’ ë¬¸ì œ ì—†ìŒ

### ì¬ë¶„ì„ ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì²« ë¶„ì„
```sql
-- ê´€ë¦¬ìê°€ "ë¶„ì„ ì‹¤í–‰" í´ë¦­
-- â†’ LABEL + TEXT + WEB í•œ ë²ˆì— ìš”ì²­

UPDATE contents SET
  label_data = '{"responses": [...]}',  -- Google API ì›ë³¸ ì‘ë‹µ
  text_data = '{"responses": [...]}',
  is_analyzed = TRUE
WHERE id = ?;

-- WEB ê²°ê³¼ëŠ” detected_contentsì— INSERT
INSERT INTO detected_contents (content_id, source_url, image_url, ...)
VALUES (...);
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: WEBë§Œ ì¬ë¶„ì„
```sql
-- ê´€ë¦¬ìê°€ "ì›¹ íƒì§€ ì¬ì‹¤í–‰" í´ë¦­
-- â†’ WEBë§Œ ìš”ì²­

-- ì‹ ê·œ URLë§Œ detected_contentsì— INSERT (ê¸°ì¡´ URL ì œì™¸)
INSERT INTO detected_contents (content_id, source_url, image_url, ...)
SELECT ...
WHERE source_url NOT IN (
  SELECT source_url FROM detected_contents WHERE content_id = ?
);
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: LABEL/TEXT ì¬ë¶„ì„
```sql
-- í•„ìš” ì‹œ label_data, text_data ë®ì–´ì“°ê¸°
UPDATE contents SET
  label_data = '{"responses": [...]}',  -- ìƒˆë¡œìš´ ë¶„ì„ ê²°ê³¼
  text_data = '{"responses": [...]}'
WHERE id = ?;
```

**í‰ê°€:** ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ ì •ìƒ ì‘ë™ âœ…

---

## ìµœì¢… ìŠ¤í‚¤ë§ˆ êµ¬ì¡°

### í…Œì´ë¸” ëª©ë¡ (4ê°œ)

1. **users** - ì‚¬ìš©ì ì •ë³´ (Supabase Auth ì—°ë™)
2. **collections** - ì½˜í…ì¸  ê·¸ë£¹
3. **contents** - ì›ë³¸ ì½˜í…ì¸  + AI ë¶„ì„ ê²°ê³¼
4. **detected_contents** - ì›¹ íƒì§€ ê²°ê³¼

~~5. analysis_results~~ â† ì‚­ì œ

### contents í…Œì´ë¸” (ìµœì¢…)

```sql
CREATE TABLE public.contents (
  -- Primary Key
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Foreign Keys
  user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
  collection_id UUID REFERENCES public.collections(id) ON DELETE CASCADE,

  -- íŒŒì¼ ì •ë³´ (ìµœì†Œí™”)
  file_name TEXT NOT NULL,
  file_path TEXT NOT NULL UNIQUE,  -- Supabase Storage ê²½ë¡œ

  -- ë¶„ì„ ìƒíƒœ
  is_analyzed BOOLEAN,  -- NULL(ëŒ€ê¸°), FALSE(ë¶„ì„ì¤‘), TRUE(ì™„ë£Œ)
  error_message TEXT,   -- ë¶„ì„ ì‹¤íŒ¨ ì‹œ ë©”ì‹œì§€

  -- AI ë¶„ì„ ê²°ê³¼ (LABEL, TEXT)
  label_data JSONB,     -- LABEL_DETECTION ì›ë³¸ ì‘ë‹µ
  text_data JSONB,      -- TEXT_DETECTION ì›ë³¸ ì‘ë‹µ

  -- Timestamps
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_contents_user_id ON public.contents(user_id);
CREATE INDEX idx_contents_collection_id ON public.contents(collection_id);
CREATE INDEX idx_contents_is_analyzed ON public.contents(is_analyzed);
CREATE INDEX idx_contents_created_at ON public.contents(created_at DESC);

-- ë¶€ë¶„ ì¸ë±ìŠ¤ (ëŒ€ê¸° ì¤‘ì¸ ì½˜í…ì¸ ë§Œ)
CREATE INDEX idx_contents_pending ON public.contents(created_at DESC)
  WHERE is_analyzed IS NULL;

-- JSONB ì¸ë±ìŠ¤ (í•„ìš” ì‹œ)
CREATE INDEX idx_contents_label_data ON public.contents USING GIN (label_data);
CREATE INDEX idx_contents_text_data ON public.contents USING GIN (text_data);
```

### detected_contents í…Œì´ë¸” (ìµœì¢…)

```sql
CREATE TABLE public.detected_contents (
  -- Primary Key
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Foreign Keys
  content_id UUID NOT NULL REFERENCES public.contents(id) ON DELETE CASCADE,

  -- ë°œê²¬ ì •ë³´ (WEB_DETECTION ê²°ê³¼)
  source_url TEXT,
  image_url TEXT NOT NULL,
  page_title TEXT,
  detection_type TEXT CHECK (detection_type IN ('full_match', 'partial_match', 'visually_similar')) NOT NULL,

  -- ê´€ë¦¬ì ê²€í† 
  admin_review_status TEXT CHECK (admin_review_status IN ('pending', 'match', 'no_match', 'cannot_compare')) DEFAULT 'pending',
  reviewed_by UUID REFERENCES public.users(id),
  reviewed_at TIMESTAMP WITH TIME ZONE,

  -- Timestamps
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_detected_contents_content_id ON public.detected_contents(content_id);
CREATE INDEX idx_detected_contents_review_status ON public.detected_contents(admin_review_status);
CREATE INDEX idx_detected_contents_detection_type ON public.detected_contents(detection_type);
CREATE INDEX idx_detected_contents_reviewed_by ON public.detected_contents(reviewed_by);
CREATE INDEX idx_detected_contents_created_at ON public.detected_contents(created_at DESC);

-- ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_detected_contents_content_status ON public.detected_contents(content_id, admin_review_status);

-- ì¤‘ë³µ URL ë°©ì§€ (ì„ íƒì )
CREATE UNIQUE INDEX idx_detected_contents_unique_url ON public.detected_contents(content_id, source_url, image_url);
```

---

## ìš°ë ¤ì‚¬í•­ ë° ê¶Œì¥ì‚¬í•­

### ğŸ”´ í•„ìˆ˜ í™•ì¸ ì‚¬í•­

#### 1. file_size, mime_type ì œê±°
**ì§ˆë¬¸:**
- ì‚¬ìš©ì/ê´€ë¦¬ì í™”ë©´ì—ì„œ íŒŒì¼ í¬ê¸°ë¥¼ í‘œì‹œí•  ì˜ˆì •ì¸ê°€ìš”?
- Google Vision API í˜¸ì¶œ ì‹œ mime-typeì´ í•„ìˆ˜ íŒŒë¼ë¯¸í„°ì¸ê°€ìš”?

**ê¶Œì¥:**
- í‘œì‹œ í•„ìš” ë˜ëŠ” API í•„ìˆ˜ â†’ **ìœ ì§€**
- ë¶ˆí•„ìš” â†’ **ì œê±°**

#### 2. is_analyzed + error_message ì¡°í•©
**ì§ˆë¬¸:**
- ì—ëŸ¬ ìƒíƒœë¥¼ ëª…í™•íˆ êµ¬ë¶„í•´ì•¼ í•˜ë‚˜ìš”?

**ê¶Œì¥:**
- ì—ëŸ¬ ì¶”ì  í•„ìš” â†’ **is_analyzed BOOLEAN + error_message TEXT**
- ì—ëŸ¬ êµ¬ë¶„ ë¶ˆí•„ìš” â†’ **is_analyzed BOOLEANë§Œ ì‚¬ìš©**

### âœ… ìŠ¹ì¸ëœ ë³€ê²½ì‚¬í•­

1. âœ… similarity_score ì œê±°
2. âœ… match_count ì œê±° (JOINìœ¼ë¡œ ê³„ì‚°)
3. âœ… analysis_results í…Œì´ë¸” ì‚­ì œ
4. âœ… label_data, text_dataë¥¼ contentsì— í†µí•©

### ğŸ“Š ìµœì¢… ìŠ¤í‚¤ë§ˆ í†µê³„

| í•­ëª© | ì´ì „ | ìµœì¢… | ë³€í™” |
|------|------|------|------|
| í…Œì´ë¸” ìˆ˜ | 5ê°œ | 4ê°œ | -20% |
| contents ì»¬ëŸ¼ | 17ê°œ | 11ê°œ | -35% |
| detected_contents ì»¬ëŸ¼ | 11ê°œ | 9ê°œ | -18% |
| íŠ¸ë¦¬ê±° ìˆ˜ | 4ê°œ | 2ê°œ | -50% |
| ì´ ì¸ë±ìŠ¤ | ~25ê°œ | ~18ê°œ | -28% |

### ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **file_size, mime_type ì œê±° ì—¬ë¶€ ìµœì¢… í™•ì¸**
2. **is_analyzed ì—ëŸ¬ ì²˜ë¦¬ ë°©ì‹ ê²°ì •**
3. **ìµœì¢… ìŠ¤í‚¤ë§ˆ DATABASE_SCHEMA.md ì—…ë°ì´íŠ¸**
4. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±** (ì¶”ê°€ ìš”êµ¬ì‚¬í•­ ì™„ë£Œ í›„)

---

**ì‘ì„±ì**: Claude Code (AI Assistant)
**ê²€í†  í•„ìš”**: file_size, mime_type, error ì²˜ë¦¬ ë°©ì‹ í™•ì¸
