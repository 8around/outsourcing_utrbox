# 단일 뷰 파일 탐색기 전환 구현 계획

**작성일:** 2024-10-27
**목표:** 2단 분할 구조를 단일 뷰 계층적 파일 탐색기로 전환

---

## 1. 개요

### 1.1 현재 구조의 문제점

현재 파일 탐색기는 다음과 같은 2단 분할 구조로 구현되어 있습니다:

```
┌────────────────────────────────────────────────┐
│  ResizablePanelGroup                           │
│  ┌──────────┬──────────────────────────────┐  │
│  │ FolderTree│ ExplorerToolbar              │  │
│  │          │ + ContentExplorerView        │  │
│  │          │                               │  │
│  └──────────┴──────────────────────────────┘  │
└────────────────────────────────────────────────┘
```

**문제점:**
- 화면 공간이 분할되어 콘텐츠 표시 영역이 좁음
- 컬렉션 목록(FolderTree)과 콘텐츠 목록이 분리되어 UX가 복잡함
- 모바일 환경에서 ResizablePanel이 불편함

### 1.2 목표 구조

단일 뷰에서 계층적으로 탐색하는 구조:

```
┌────────────────────────────────────────────────┐
│  ExplorerToolbar (with Breadcrumb)             │
├────────────────────────────────────────────────┤
│  ContentExplorerView                           │
│  ┌──────────────────────────────────────────┐ │
│  │ Level 1: Collections + Uncategorized     │ │
│  │ ┌────┐ ┌────┐ ┌────┐ ┌────┐             │ │
│  │ │Col1│ │Col2│ │File│ │File│             │ │
│  │ └────┘ └────┘ └────┘ └────┘             │ │
│  │                                          │ │
│  │ Level 2: Collection Contents (on click) │ │
│  │ ┌────┐ ┌────┐ ┌────┐                    │ │
│  │ │File│ │File│ │File│                    │ │
│  │ └────┘ └────┘ └────┘                    │ │
│  └──────────────────────────────────────────┘ │
└────────────────────────────────────────────────┘
```

---

## 2. 변경 사항 상세

### 2.1 제거할 컴포넌트 및 구조

1. **ResizablePanelGroup, ResizablePanel, ResizableHandle**
   - 위치: `app/(user)/page.tsx`
   - 이유: 단일 뷰로 전환하므로 불필요

2. **FolderTree 컴포넌트**
   - 파일: `components/explorer/FolderTree.tsx`
   - 이유: ContentExplorerView에서 컬렉션을 직접 표시

### 2.2 수정할 파일

#### 2.2.1 `lib/stores/explorerStore.ts`

**추가 상태:**
```typescript
currentPath: string | null  // null = 루트, collectionId = 해당 컬렉션 내부
```

**추가 액션:**
```typescript
navigateToCollection: (collectionId: string) => void
navigateToRoot: () => void
```

**변경 이유:**
- 현재 탐색 위치를 추적하기 위함
- selectedCollectionId는 currentPath로 대체 (의미상 동일)

#### 2.2.2 `components/explorer/ContentExplorerView.tsx`

**주요 변경사항:**

1. **Props 추가:**
```typescript
interface ContentExplorerViewProps {
  contents: Content[]
  collections: Collection[]  // 추가
  currentPath: string | null  // 추가
  viewMode: ViewMode
  selectedIds: string[]
  onSelectContent: (ids: string[]) => void
  onOpenContent: (id: string) => void
  onNavigateToCollection: (id: string) => void  // 추가
}
```

2. **계층적 렌더링 로직:**

**Level 1 (currentPath === null):**
- 컬렉션 카드 렌더링
- 미분류 콘텐츠 렌더링 (collection_id === null)

**Level 2 (currentPath !== null):**
- 선택된 컬렉션의 콘텐츠만 렌더링

3. **컬렉션 카드 디자인:**

**그리드뷰:**
```tsx
<Card className="collection-card">
  <FolderOpen className="h-12 w-12" />
  <h3>{collection.name}</h3>
  <Badge>{contentCount}개</Badge>
</Card>
```

**리스트뷰:**
```tsx
<div className="collection-row">
  <FolderOpen className="h-8 w-8" />
  <span>{collection.name}</span>
  <Badge>{contentCount}개</Badge>
  <span>{format(collection.created_at)}</span>
</div>
```

4. **클릭 이벤트:**
- 컬렉션 카드 클릭: `onNavigateToCollection(collection.id)` 호출
- 콘텐츠 카드 클릭: 기존 로직 유지

#### 2.2.3 `components/explorer/ExplorerToolbar.tsx`

**추가 요소:**

1. **Breadcrumb 컴포넌트:**
```tsx
import { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList, BreadcrumbSeparator } from '@/components/ui/breadcrumb'

<Breadcrumb>
  <BreadcrumbList>
    <BreadcrumbItem>
      <BreadcrumbLink onClick={onNavigateToRoot}>
        모든 콘텐츠
      </BreadcrumbLink>
    </BreadcrumbItem>
    {currentCollection && (
      <>
        <BreadcrumbSeparator />
        <BreadcrumbItem>
          <BreadcrumbLink>{currentCollection.name}</BreadcrumbLink>
        </BreadcrumbItem>
      </>
    )}
  </BreadcrumbList>
</Breadcrumb>
```

2. **Props 추가:**
```typescript
interface ExplorerToolbarProps {
  currentPath: string | null  // 추가
  currentCollection: Collection | null  // 추가
  onNavigateToRoot: () => void  // 추가
  // ... 기존 props
}
```

#### 2.2.4 `app/(user)/page.tsx`

**레이아웃 간소화:**

```tsx
// 이전
<ResizablePanelGroup direction="horizontal">
  <ResizablePanel defaultSize={20}>
    <FolderTree ... />
  </ResizablePanel>
  <ResizableHandle withHandle />
  <ResizablePanel defaultSize={80}>
    <ExplorerToolbar ... />
    <ContentExplorerView ... />
  </ResizablePanel>
</ResizablePanelGroup>

// 이후
<div className="flex h-full flex-col">
  <ExplorerToolbar ... />
  <div className="flex-1 overflow-hidden">
    <ContentExplorerView ... />
  </div>
</div>
```

**데이터 필터링 로직:**

```typescript
const { currentPath, navigateToCollection, navigateToRoot } = useExplorerStore()

// Level 1: 모든 컬렉션 + 미분류 콘텐츠
const displayData = useMemo(() => {
  if (currentPath === null) {
    return {
      collections: userCollections,
      contents: userContents.filter(c => c.collection_id === null)
    }
  }

  // Level 2: 선택된 컬렉션의 콘텐츠만
  return {
    collections: [],
    contents: userContents.filter(c => c.collection_id === currentPath)
  }
}, [currentPath, userCollections, userContents])

const currentCollection = currentPath
  ? userCollections.find(c => c.id === currentPath)
  : null
```

#### 2.2.5 `components/explorer/index.ts`

**변경 사항:**
```typescript
// 제거
// export * from './FolderTree'

// 유지
export * from './StatsCards'
export * from './ContentExplorerView'
export * from './ExplorerToolbar'
```

---

## 3. UI/UX 상세 설계

### 3.1 Level 1 (루트 뷰)

**표시 항목:**
1. 컬렉션 카드들
2. 미분류 콘텐츠 카드들

**그리드뷰 레이아웃:**
```
┌────────┐ ┌────────┐ ┌────────┐
│ 📁 Col1│ │ 📁 Col2│ │ 🖼️ File│
│ 5개     │ │ 3개     │ │ image  │
└────────┘ └────────┘ └────────┘
```

**리스트뷰 레이아웃:**
```
📁 프로젝트 A        5개    2024.01.15
📁 마케팅 자료      3개    2024.02.10
🖼️ 테스트 이미지    -      2024.10.19
```

**정렬:**
- 컬렉션이 먼저 표시 (name 기준 정렬)
- 그 다음 미분류 콘텐츠 표시 (선택된 정렬 기준 적용)

### 3.2 Level 2 (컬렉션 뷰)

**Breadcrumb:**
```
모든 콘텐츠 > 프로젝트 A
```

**표시 항목:**
- 선택된 컬렉션의 콘텐츠만 표시
- 정렬/검색/필터 기능 유지

**뒤로가기:**
- Breadcrumb의 "모든 콘텐츠" 클릭
- 또는 브라우저 뒤로가기 (선택사항)

### 3.3 컬렉션 카드 스타일

**그리드뷰 카드:**
```tsx
<Card className="group cursor-pointer hover:border-primary transition-colors">
  <div className="p-4 flex flex-col items-center gap-3">
    <FolderOpen className="h-16 w-16 text-primary" />
    <div className="text-center">
      <h3 className="font-semibold truncate">{collection.name}</h3>
      <Badge variant="secondary" className="mt-2">
        {contentCount}개
      </Badge>
    </div>
  </div>
</Card>
```

**리스트뷰 행:**
```tsx
<div className="flex items-center gap-4 p-4 hover:bg-secondary-50 cursor-pointer">
  <FolderOpen className="h-8 w-8 text-primary flex-shrink-0" />
  <div className="flex-1 min-w-0">
    <h3 className="font-semibold truncate">{collection.name}</h3>
  </div>
  <Badge variant="secondary">{contentCount}개</Badge>
  <span className="text-sm text-secondary-500">
    {format(collection.created_at, 'yyyy.MM.dd')}
  </span>
</div>
```

---

## 4. 데이터 흐름

### 4.1 상태 관리 (explorerStore)

```typescript
interface ExplorerStore {
  // 네비게이션 상태
  currentPath: string | null  // null = 루트, collectionId = 컬렉션 내부

  // 선택 상태
  selectedContentIds: string[]

  // 뷰 설정
  viewMode: ViewMode
  sortBy: SortBy
  searchQuery: string

  // 액션
  navigateToCollection: (collectionId: string) => void
  navigateToRoot: () => void
  setSelectedContents: (ids: string[]) => void
  // ... 기존 액션들
}
```

### 4.2 컴포넌트 간 데이터 흐름

```
ExplorerPage
  │
  ├─> explorerStore.currentPath
  ├─> displayData 계산 (collections + contents)
  │
  ├─> ExplorerToolbar
  │   ├─ currentPath 전달
  │   ├─ currentCollection 전달
  │   └─ onNavigateToRoot 전달
  │
  └─> ContentExplorerView
      ├─ collections 전달
      ├─ contents 전달
      ├─ currentPath 전달
      └─ onNavigateToCollection 전달
```

### 4.3 사용자 인터랙션 흐름

**시나리오 1: 컬렉션 탐색**
```
1. 사용자가 루트 뷰에서 "프로젝트 A" 컬렉션 클릭
   ↓
2. ContentExplorerView.onNavigateToCollection('collection-1') 호출
   ↓
3. explorerStore.navigateToCollection('collection-1') 실행
   ↓
4. currentPath = 'collection-1' 로 변경
   ↓
5. ExplorerPage가 리렌더링
   ↓
6. displayData = { collections: [], contents: [...] }
   ↓
7. ContentExplorerView가 Level 2 모드로 렌더링
   ↓
8. Breadcrumb에 "모든 콘텐츠 > 프로젝트 A" 표시
```

**시나리오 2: 루트로 복귀**
```
1. 사용자가 Breadcrumb의 "모든 콘텐츠" 클릭
   ↓
2. ExplorerToolbar.onNavigateToRoot() 호출
   ↓
3. explorerStore.navigateToRoot() 실행
   ↓
4. currentPath = null 로 변경
   ↓
5. ExplorerPage가 리렌더링
   ↓
6. displayData = { collections: [...], contents: [...] }
   ↓
7. ContentExplorerView가 Level 1 모드로 렌더링
   ↓
8. Breadcrumb에 "모든 콘텐츠"만 표시
```

---

## 5. 구현 순서

### 5.1 Phase 1: 상태 관리 수정
- [ ] explorerStore.ts 수정
  - currentPath 상태 추가
  - navigateToCollection, navigateToRoot 액션 추가
  - selectedCollectionId 관련 코드 제거/수정

### 5.2 Phase 2: 컴포넌트 수정
- [ ] ExplorerToolbar.tsx 수정
  - Breadcrumb 추가
  - Props 업데이트
- [ ] ContentExplorerView.tsx 대폭 수정
  - 계층적 렌더링 로직 구현
  - 컬렉션 카드 컴포넌트 추가
  - Props 업데이트

### 5.3 Phase 3: 레이아웃 간소화
- [ ] app/(user)/page.tsx 수정
  - ResizablePanel 구조 제거
  - FolderTree 제거
  - displayData 로직 구현
- [ ] components/explorer/index.ts 정리
  - FolderTree export 제거
- [ ] components/explorer/FolderTree.tsx 삭제

### 5.4 Phase 4: 테스트 및 검증
- [ ] 빌드 성공 확인
- [ ] 기능 테스트
  - 루트 뷰 정상 표시
  - 컬렉션 클릭 동작
  - Breadcrumb 네비게이션
  - 그리드/리스트 뷰 전환
  - 검색/정렬 기능
- [ ] UI/UX 검증
  - 모바일 반응형
  - 접근성 (키보드 네비게이션)

---

## 6. 예상 이슈 및 해결 방안

### 6.1 컬렉션과 콘텐츠의 혼합 표시

**이슈:**
- 그리드뷰에서 컬렉션 카드와 콘텐츠 카드의 크기/스타일이 다를 수 있음

**해결:**
- 컬렉션 카드를 콘텐츠 카드와 동일한 aspect-ratio로 디자인
- 또는 별도 섹션으로 구분 표시 (옵션)

### 6.2 정렬 기준

**이슈:**
- 컬렉션과 콘텐츠가 섞여 있을 때 정렬 기준이 애매함

**해결:**
- 컬렉션 우선 표시 (name 기준 정렬)
- 그 다음 콘텐츠 표시 (선택된 정렬 기준 적용)

### 6.3 검색 기능

**이슈:**
- 루트 뷰에서 검색 시 컬렉션명도 검색 대상인지 불명확

**해결:**
- 검색어가 있을 경우:
  - 컬렉션명이 일치하는 컬렉션 표시
  - 파일명이 일치하는 콘텐츠 표시 (모든 컬렉션 포함)

### 6.4 선택 상태 유지

**이슈:**
- 컬렉션 진입 시 이전 선택 상태 유지 여부

**해결:**
- 네비게이션 시 선택 상태 초기화
- `navigateToCollection`, `navigateToRoot`에서 `setSelectedContents([])` 호출

---

## 7. 성공 기준

### 7.1 기능적 요구사항
- [x] 루트 뷰에서 컬렉션과 미분류 콘텐츠 함께 표시
- [x] 컬렉션 단일 클릭으로 진입
- [x] Breadcrumb로 현재 위치 표시 및 네비게이션
- [x] 그리드/리스트 뷰 전환 유지
- [x] 검색/정렬 기능 유지

### 7.2 UX 요구사항
- [x] 직관적인 네비게이션
- [x] 빠른 응답 속도 (렌더링 최적화)
- [x] 모바일 반응형
- [x] 접근성 (키보드 네비게이션, ARIA 속성)

### 7.3 코드 품질
- [x] TypeScript 타입 안정성
- [x] 컴포넌트 재사용성
- [x] 상태 관리 명확성
- [x] 테스트 가능성

---

## 8. 향후 개선 사항 (Optional)

### 8.1 고급 네비게이션
- 브라우저 히스토리 API 통합 (뒤로가기 버튼 지원)
- URL 경로 동기화 (e.g., `/collections/collection-1`)

### 8.2 드래그 앤 드롭
- 콘텐츠를 컬렉션으로 드래그하여 이동
- 컬렉션 간 콘텐츠 이동

### 8.3 컨텍스트 메뉴
- 컬렉션 우클릭: 이름 변경, 삭제, 새 탭에서 열기
- 콘텐츠 우클릭: 이동, 삭제, 다운로드

### 8.4 다중 선택 개선
- Shift + 클릭으로 범위 선택
- Ctrl/Cmd + 클릭으로 다중 선택

---

**문서 버전:** 1.0
**최종 수정:** 2024-10-27
