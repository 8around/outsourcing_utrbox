# 031. ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ ë° ì‚¬ìš©ì ìŠ¹ì¸ ê¸°ëŠ¥ (ê°œì •íŒ)

## ğŸ“‹ ê°œìš”

í˜„ì¬ ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ(`app/admin/dashboard/page.tsx`)ëŠ” ì •ì  ë°ì´í„°(0ìœ¼ë¡œ í•˜ë“œì½”ë”©)ë¥¼ í‘œì‹œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ Supabase ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³ , ê° ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ë¡œë”©ë˜ë©°, í˜ì´ì§€ë„¤ì´ì…˜ì„ í†µí•´ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ğŸ¯ ëª©í‘œ

1. **ë…ë¦½ì  ì»´í¬ë„ŒíŠ¸ ë¡œë”©**
   - ê° ì»´í¬ë„ŒíŠ¸(í†µê³„, ëŒ€ê¸°ì¤‘ ì½˜í…ì¸ , ê°€ì… ìš”ì²­)ê°€ ë…ë¦½ì ìœ¼ë¡œ ë°ì´í„° ë¡œë”©
   - í•œ ì»´í¬ë„ŒíŠ¸ì˜ ë¡œë”©ì´ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ
   - í˜ì´ì§€ ì „ì²´ê°€ ì•„ë‹Œ ì»´í¬ë„ŒíŠ¸ë³„ ë¡œë”© ìƒíƒœ ê´€ë¦¬

2. **ìŠ¤ì¼ˆë ˆí†¤ UI**
   - í†µê³„ ì¹´ë“œ: ìˆ«ì ë¶€ë¶„ë§Œ ìŠ¤ì¼ˆë ˆí†¤ ì²˜ë¦¬ (ì•„ì´ì½˜, ì œëª©, ë‹¨ìœ„ëŠ” ì¦‰ì‹œ í‘œì‹œ)
   - ëŒ€ê¸°ì¤‘ ì½˜í…ì¸ : ì „ì²´ ì¹´ë“œ ìŠ¤ì¼ˆë ˆí†¤
   - ê°€ì… ìš”ì²­: ì „ì²´ ì¹´ë“œ ìŠ¤ì¼ˆë ˆí†¤

3. **í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„**
   - ìµœê·¼ ëŒ€ê¸°ì¤‘ì¸ ì½˜í…ì¸ : 10ê°œì”© í˜ì´ì§€ë„¤ì´ì…˜
   - ìµœê·¼ ê°€ì… ìš”ì²­: 10ê°œì”© í˜ì´ì§€ë„¤ì´ì…˜
   - ê° ì¹´ë“œ í•˜ë‹¨ì— í˜ì´ì§€ë„¤ì´ì…˜ ì»¨íŠ¸ë¡¤

4. **ì‚¬ìš©ì ìŠ¹ì¸/ê±°ë¶€ ë¹ ë¥¸ ì‘ì—…**
   - ê°€ì… ìš”ì²­ ì¹´ë“œì—ì„œ ì¦‰ì‹œ ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬
   - ë²„íŠ¼ í´ë¦­ ì‹œ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸

## ğŸ“Š í˜„ì¬ ìƒíƒœ ë¶„ì„

### ê¸°ì¡´ êµ¬í˜„
```typescript
// app/admin/dashboard/page.tsx (í˜„ì¬)
export default function AdminDashboardPage() {
  return (
    <div className="space-y-6">
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-5">
        <StatsCard title="ì´ ì½˜í…ì¸ " value={0} icon={...} unit="ê±´" />
        {/* ... ë‚˜ë¨¸ì§€ í†µê³„ ì¹´ë“œ ... */}
      </div>
      <ActivityFeed pendingContents={[]} pendingUsers={[]} maxItems={10} />
    </div>
  )
}
```

### í™œìš© ê°€ëŠ¥í•œ ê¸°ì¡´ í•¨ìˆ˜

#### lib/api/users.ts
- âœ… `getUsersWithPagination(params)` - **ì¬ì‚¬ìš© ê°€ëŠ¥**
  - í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì› (`page`, `pageSize`)
  - `is_approved` í•„í„° ì§€ì› (null, true, false)
  - `totalCount` ë°˜í™˜ìœ¼ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ ê°€ëŠ¥

- âœ… `updateUserApproval(id, isApproved)` - **ì¬ì‚¬ìš© ê°€ëŠ¥**
  - ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬

#### lib/api/contents.ts
- âœ… `getContentsWithPagination(params)` - **ì¬ì‚¬ìš© ê°€ëŠ¥**
  - í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì› (`page`, `pageSize`)
  - `is_analyzed` í•„í„° ì§€ì› (null, false, true)
  - `totalCount` ë°˜í™˜ìœ¼ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ ê°€ëŠ¥

- âŒ `getContentsCount(userId)` - **ì¬ì‚¬ìš© ë¶ˆê°€**
  - userId í•„í„°ê°€ í•„ìˆ˜ì—¬ì„œ ì „ì²´ í†µê³„ì— ì‚¬ìš© ë¶ˆê°€

### ìƒˆë¡œ êµ¬í˜„í•´ì•¼ í•  í•¨ìˆ˜
- `getDashboardStats()` - ì „ì²´ í†µê³„ ì¡°íšŒ (userId í•„í„° ì—†ì´)

## ğŸ—ï¸ êµ¬í˜„ ê³„íš

### 1ë‹¨ê³„: ëŒ€ì‹œë³´ë“œ í†µê³„ API ìƒì„±

#### 1.1 í†µê³„ ì¡°íšŒ í•¨ìˆ˜ ìƒì„±
**íŒŒì¼**: `lib/api/dashboard.ts` (ì‹ ê·œ ìƒì„±)

```typescript
import { supabase } from '@/lib/supabase/client'

export interface DashboardStats {
  totalContents: number
  pendingContents: number      // is_analyzed IS NULL
  analyzingContents: number    // is_analyzed = FALSE
  completedContents: number    // is_analyzed = TRUE
  totalUsers: number
}

export interface DashboardStatsResponse {
  data: DashboardStats | null
  error: string | null
  success: boolean
}

/**
 * ëŒ€ì‹œë³´ë“œ í†µê³„ ë°ì´í„° ì¡°íšŒ (ê´€ë¦¬ììš© - userId í•„í„° ì—†ìŒ)
 * - ì½˜í…ì¸  ìƒíƒœë³„ ê°œìˆ˜
 * - ì „ì²´ íšŒì› ìˆ˜
 */
export async function getDashboardStats(): Promise<DashboardStatsResponse> {
  try {
    // ë³‘ë ¬ ì¿¼ë¦¬ ì‹¤í–‰ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
    const [
      totalContentsResult,
      pendingContentsResult,
      analyzingContentsResult,
      completedContentsResult,
      totalUsersResult,
    ] = await Promise.all([
      // ì´ ì½˜í…ì¸  ìˆ˜
      supabase.from('contents').select('*', { count: 'exact', head: true }),

      // ëŒ€ê¸°ì¤‘ (is_analyzed IS NULL)
      supabase.from('contents').select('*', { count: 'exact', head: true }).is('is_analyzed', null),

      // ë¶„ì„ì¤‘ (is_analyzed = FALSE)
      supabase.from('contents').select('*', { count: 'exact', head: true }).eq('is_analyzed', false),

      // ë¶„ì„ì™„ë£Œ (is_analyzed = TRUE)
      supabase.from('contents').select('*', { count: 'exact', head: true }).eq('is_analyzed', true),

      // ì´ íšŒì› ìˆ˜
      supabase.from('users').select('*', { count: 'exact', head: true }),
    ])

    // ì—ëŸ¬ ì²´í¬
    if (totalContentsResult.error) throw totalContentsResult.error
    if (pendingContentsResult.error) throw pendingContentsResult.error
    if (analyzingContentsResult.error) throw analyzingContentsResult.error
    if (completedContentsResult.error) throw completedContentsResult.error
    if (totalUsersResult.error) throw totalUsersResult.error

    const stats: DashboardStats = {
      totalContents: totalContentsResult.count || 0,
      pendingContents: pendingContentsResult.count || 0,
      analyzingContents: analyzingContentsResult.count || 0,
      completedContents: completedContentsResult.count || 0,
      totalUsers: totalUsersResult.count || 0,
    }

    return {
      data: stats,
      error: null,
      success: true,
    }
  } catch (error) {
    console.error('ëŒ€ì‹œë³´ë“œ í†µê³„ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:', error)
    return {
      data: null,
      error: error instanceof Error ? error.message : 'í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
      success: false,
    }
  }
}
```

### 2ë‹¨ê³„: ë…ë¦½ì  ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° êµ¬í˜„

#### 2.1 DashboardStats ì»´í¬ë„ŒíŠ¸ (í†µê³„ ì¹´ë“œ)
**íŒŒì¼**: `components/admin/dashboard/DashboardStats.tsx` (ì‹ ê·œ ìƒì„±)

```typescript
'use client'

import { useEffect, useState } from 'react'
import { StatsCard } from './StatsCard'
import { Skeleton } from '@/components/ui/skeleton'
import { FileImage, Clock, CheckCircle2, Users, Activity } from 'lucide-react'
import { getDashboardStats, DashboardStats as Stats } from '@/lib/api/dashboard'
import { useToast } from '@/hooks/use-toast'

export function DashboardStats() {
  const { toast } = useToast()
  const [stats, setStats] = useState<Stats | null>(null)
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    const loadStats = async () => {
      setIsLoading(true)
      try {
        const result = await getDashboardStats()

        if (result.success && result.data) {
          setStats(result.data)
        } else {
          toast({
            variant: 'destructive',
            title: 'í†µê³„ ì¡°íšŒ ì‹¤íŒ¨',
            description: result.error || 'í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
          })
        }
      } catch (error) {
        console.error('í†µê³„ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error)
        toast({
          variant: 'destructive',
          title: 'í†µê³„ ì¡°íšŒ ì‹¤íŒ¨',
          description: 'í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        })
      } finally {
        setIsLoading(false)
      }
    }

    loadStats()
  }, [])

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-5">
      <StatsCard
        title="ì´ ì½˜í…ì¸ "
        value={stats?.totalContents}
        icon={<FileImage className="h-5 w-5" />}
        unit="ê±´"
        isLoading={isLoading}
      />
      <StatsCard
        title="ëŒ€ê¸°ì¤‘"
        value={stats?.pendingContents}
        icon={<Clock className="h-5 w-5" />}
        unit="ê±´"
        isLoading={isLoading}
      />
      <StatsCard
        title="ë¶„ì„ì¤‘"
        value={stats?.analyzingContents}
        icon={<Activity className="h-5 w-5" />}
        unit="ê±´"
        isLoading={isLoading}
      />
      <StatsCard
        title="ë¶„ì„ì™„ë£Œ"
        value={stats?.completedContents}
        icon={<CheckCircle2 className="h-5 w-5" />}
        unit="ê±´"
        isLoading={isLoading}
      />
      <StatsCard
        title="íšŒì›ìˆ˜"
        value={stats?.totalUsers}
        icon={<Users className="h-5 w-5" />}
        unit="ëª…"
        isLoading={isLoading}
      />
    </div>
  )
}
```

#### 2.2 StatsCard ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •
**íŒŒì¼**: `components/admin/dashboard/StatsCard.tsx` (ìˆ˜ì •)

```typescript
import { Card, CardContent } from '@/components/ui/card'
import { Skeleton } from '@/components/ui/skeleton'

interface StatsCardProps {
  title: string
  value?: number
  icon: React.ReactNode
  unit: string
  isLoading?: boolean
}

export function StatsCard({ title, value, icon, unit, isLoading = false }: StatsCardProps) {
  return (
    <Card>
      <CardContent className="p-6">
        <div className="flex items-center justify-between">
          <div className="flex-1">
            <p className="text-sm font-medium text-gray-600">{title}</p>
            <div className="mt-2 flex items-baseline gap-2">
              {isLoading ? (
                <Skeleton className="h-8 w-16" />
              ) : (
                <>
                  <p className="text-2xl font-bold text-gray-900">{value ?? 0}</p>
                  <span className="text-sm text-gray-500">{unit}</span>
                </>
              )}
            </div>
          </div>
          <div className="rounded-full bg-blue-100 p-3 text-blue-600">{icon}</div>
        </div>
      </CardContent>
    </Card>
  )
}
```

#### 2.3 PendingContentsCard ì»´í¬ë„ŒíŠ¸
**íŒŒì¼**: `components/admin/dashboard/PendingContentsCard.tsx` (ì‹ ê·œ ìƒì„±)

```typescript
'use client'

import { useEffect, useState } from 'react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Skeleton } from '@/components/ui/skeleton'
import { FileImage, ChevronLeft, ChevronRight } from 'lucide-react'
import { formatDistanceToNow } from 'date-fns'
import { ko } from 'date-fns/locale'
import { getContentsWithPagination } from '@/lib/api/contents'
import { useToast } from '@/hooks/use-toast'
import type { Content } from '@/types/database.type'

export function PendingContentsCard() {
  const { toast } = useToast()
  const [contents, setContents] = useState<Content[]>([])
  const [totalCount, setTotalCount] = useState(0)
  const [page, setPage] = useState(1)
  const [isLoading, setIsLoading] = useState(true)
  const pageSize = 10

  const totalPages = Math.ceil(totalCount / pageSize)

  const loadContents = async (currentPage: number) => {
    setIsLoading(true)
    try {
      const result = await getContentsWithPagination({
        page: currentPage,
        pageSize,
        is_analyzed: null, // ëŒ€ê¸°ì¤‘ë§Œ
      })

      if (result.success && result.data) {
        setContents(result.data)
        setTotalCount(result.totalCount)
      } else {
        toast({
          variant: 'destructive',
          title: 'ì½˜í…ì¸  ì¡°íšŒ ì‹¤íŒ¨',
          description: result.error || 'ëŒ€ê¸°ì¤‘ ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        })
      }
    } catch (error) {
      console.error('ëŒ€ê¸°ì¤‘ ì½˜í…ì¸  ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error)
      toast({
        variant: 'destructive',
        title: 'ì½˜í…ì¸  ì¡°íšŒ ì‹¤íŒ¨',
        description: 'ëŒ€ê¸°ì¤‘ ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      })
    } finally {
      setIsLoading(false)
    }
  }

  useEffect(() => {
    loadContents(page)
  }, [page])

  const getTimeAgo = (dateString: string) => {
    try {
      return formatDistanceToNow(new Date(dateString), {
        addSuffix: true,
        locale: ko,
      })
    } catch {
      return 'ì•Œ ìˆ˜ ì—†ìŒ'
    }
  }

  const handlePrevPage = () => {
    if (page > 1) {
      setPage(page - 1)
    }
  }

  const handleNextPage = () => {
    if (page < totalPages) {
      setPage(page + 1)
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2 text-lg">
          <FileImage className="h-5 w-5 text-blue-600" />
          ìµœê·¼ ëŒ€ê¸°ì¤‘ì¸ ì½˜í…ì¸ 
        </CardTitle>
      </CardHeader>
      <CardContent>
        {isLoading ? (
          <div className="space-y-3">
            {Array.from({ length: 3 }).map((_, i) => (
              <div key={i} className="flex items-start justify-between border-b pb-3">
                <div className="flex-1 space-y-2">
                  <Skeleton className="h-4 w-3/4" />
                  <Skeleton className="h-3 w-1/2" />
                </div>
                <div className="ml-4 space-y-1">
                  <Skeleton className="h-6 w-16" />
                  <Skeleton className="h-3 w-20" />
                </div>
              </div>
            ))}
          </div>
        ) : contents.length === 0 ? (
          <p className="text-sm text-gray-500">ëŒ€ê¸°ì¤‘ì¸ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        ) : (
          <>
            <div className="space-y-3">
              {contents.map((content) => (
                <div
                  key={content.id}
                  className="flex items-start justify-between border-b pb-3 last:border-0 last:pb-0"
                >
                  <div className="flex-1">
                    <p className="text-sm font-medium text-gray-900">{content.file_name}</p>
                    <p className="text-xs text-gray-500">ì—…ë¡œë”: {content.user_name || 'ì•Œ ìˆ˜ ì—†ìŒ'}</p>
                  </div>
                  <div className="ml-4 flex flex-col items-end gap-1">
                    <Badge variant="secondary" className="bg-gray-100 text-gray-700">
                      ëŒ€ê¸°ì¤‘
                    </Badge>
                    <span className="text-xs text-gray-400">{getTimeAgo(content.created_at)}</span>
                  </div>
                </div>
              ))}
            </div>

            {/* í˜ì´ì§€ë„¤ì´ì…˜ */}
            {totalPages > 1 && (
              <div className="mt-4 flex items-center justify-between border-t pt-4">
                <p className="text-sm text-gray-600">
                  {totalCount}ê±´ ì¤‘ {(page - 1) * pageSize + 1}-
                  {Math.min(page * pageSize, totalCount)}
                </p>
                <div className="flex gap-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handlePrevPage}
                    disabled={page === 1}
                  >
                    <ChevronLeft className="h-4 w-4" />
                  </Button>
                  <div className="flex items-center gap-1 px-2">
                    <span className="text-sm font-medium">{page}</span>
                    <span className="text-sm text-gray-500">/ {totalPages}</span>
                  </div>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handleNextPage}
                    disabled={page === totalPages}
                  >
                    <ChevronRight className="h-4 w-4" />
                  </Button>
                </div>
              </div>
            )}
          </>
        )}
      </CardContent>
    </Card>
  )
}
```

#### 2.4 PendingUsersCard ì»´í¬ë„ŒíŠ¸
**íŒŒì¼**: `components/admin/dashboard/PendingUsersCard.tsx` (ì‹ ê·œ ìƒì„±)

```typescript
'use client'

import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Skeleton } from '@/components/ui/skeleton'
import { UserPlus, ArrowRight, Check, X, ChevronLeft, ChevronRight } from 'lucide-react'
import { formatDistanceToNow } from 'date-fns'
import { ko } from 'date-fns/locale'
import { getUsersWithPagination, updateUserApproval } from '@/lib/api/users'
import { useToast } from '@/hooks/use-toast'
import { useAdminStore } from '@/lib/admin/store'
import type { User } from '@/types/database.type'

export function PendingUsersCard() {
  const router = useRouter()
  const { toast } = useToast()
  const { setUserFilters } = useAdminStore()

  const [users, setUsers] = useState<User[]>([])
  const [totalCount, setTotalCount] = useState(0)
  const [page, setPage] = useState(1)
  const [isLoading, setIsLoading] = useState(true)
  const [processingUsers, setProcessingUsers] = useState<Set<string>>(new Set())

  const pageSize = 10
  const totalPages = Math.ceil(totalCount / pageSize)

  const loadUsers = async (currentPage: number) => {
    setIsLoading(true)
    try {
      const result = await getUsersWithPagination({
        page: currentPage,
        pageSize,
        is_approved: null, // ìŠ¹ì¸ ëŒ€ê¸°ë§Œ
        role: 'member',
      })

      if (result.success && result.data) {
        setUsers(result.data)
        setTotalCount(result.totalCount)
      } else {
        toast({
          variant: 'destructive',
          title: 'ê°€ì… ìš”ì²­ ì¡°íšŒ ì‹¤íŒ¨',
          description: result.error || 'ê°€ì… ìš”ì²­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        })
      }
    } catch (error) {
      console.error('ê°€ì… ìš”ì²­ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error)
      toast({
        variant: 'destructive',
        title: 'ê°€ì… ìš”ì²­ ì¡°íšŒ ì‹¤íŒ¨',
        description: 'ê°€ì… ìš”ì²­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      })
    } finally {
      setIsLoading(false)
    }
  }

  useEffect(() => {
    loadUsers(page)
  }, [page])

  const getTimeAgo = (dateString: string) => {
    try {
      return formatDistanceToNow(new Date(dateString), {
        addSuffix: true,
        locale: ko,
      })
    } catch {
      return 'ì•Œ ìˆ˜ ì—†ìŒ'
    }
  }

  const handleViewAllUsers = () => {
    setUserFilters({
      is_approved: null,
      role: 'member',
      page: 1,
      search: undefined,
    })
    router.push('/admin/users')
  }

  const handleApproveUser = async (userId: string, userName: string) => {
    if (processingUsers.has(userId)) return

    setProcessingUsers((prev) => new Set(prev).add(userId))

    try {
      const result = await updateUserApproval(userId, true)

      if (result.success) {
        toast({
          title: 'ìŠ¹ì¸ ì™„ë£Œ',
          description: `${userName} ë‹˜ì˜ ê°€ì…ì„ ìŠ¹ì¸í–ˆìŠµë‹ˆë‹¤.`,
        })
        // í˜„ì¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        await loadUsers(page)
      } else {
        toast({
          variant: 'destructive',
          title: 'ìŠ¹ì¸ ì‹¤íŒ¨',
          description: result.error || 'ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
        })
      }
    } catch (error) {
      console.error('ì‚¬ìš©ì ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜:', error)
      toast({
        variant: 'destructive',
        title: 'ìŠ¹ì¸ ì‹¤íŒ¨',
        description: 'ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
      })
    } finally {
      setProcessingUsers((prev) => {
        const next = new Set(prev)
        next.delete(userId)
        return next
      })
    }
  }

  const handleRejectUser = async (userId: string, userName: string) => {
    if (processingUsers.has(userId)) return

    setProcessingUsers((prev) => new Set(prev).add(userId))

    try {
      const result = await updateUserApproval(userId, false)

      if (result.success) {
        toast({
          title: 'ê±°ë¶€ ì™„ë£Œ',
          description: `${userName} ë‹˜ì˜ ê°€ì…ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.`,
        })
        // í˜„ì¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        await loadUsers(page)
      } else {
        toast({
          variant: 'destructive',
          title: 'ê±°ë¶€ ì‹¤íŒ¨',
          description: result.error || 'ê±°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
        })
      }
    } catch (error) {
      console.error('ì‚¬ìš©ì ê±°ë¶€ ì¤‘ ì˜¤ë¥˜:', error)
      toast({
        variant: 'destructive',
        title: 'ê±°ë¶€ ì‹¤íŒ¨',
        description: 'ê±°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
      })
    } finally {
      setProcessingUsers((prev) => {
        const next = new Set(prev)
        next.delete(userId)
        return next
      })
    }
  }

  const handlePrevPage = () => {
    if (page > 1) {
      setPage(page - 1)
    }
  }

  const handleNextPage = () => {
    if (page < totalPages) {
      setPage(page + 1)
    }
  }

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-4">
        <CardTitle className="flex items-center gap-2 text-lg">
          <UserPlus className="h-5 w-5 text-green-600" />
          ìµœê·¼ ê°€ì… ìš”ì²­
        </CardTitle>
        {users.length > 0 && (
          <Button
            variant="ghost"
            size="sm"
            onClick={handleViewAllUsers}
            className="gap-1 text-blue-600 hover:text-blue-700"
          >
            ì „ì²´ë³´ê¸°
            <ArrowRight className="h-4 w-4" />
          </Button>
        )}
      </CardHeader>
      <CardContent>
        {isLoading ? (
          <div className="space-y-4">
            {Array.from({ length: 3 }).map((_, i) => (
              <div key={i} className="flex items-start justify-between border-b pb-4">
                <div className="flex-1 space-y-2">
                  <Skeleton className="h-4 w-3/4" />
                  <Skeleton className="h-3 w-1/2" />
                  <Skeleton className="h-3 w-1/3" />
                </div>
                <div className="ml-4 space-y-2">
                  <Skeleton className="h-8 w-16" />
                  <Skeleton className="h-8 w-16" />
                </div>
              </div>
            ))}
          </div>
        ) : users.length === 0 ? (
          <p className="text-sm text-gray-500">ê°€ì… ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        ) : (
          <>
            <div className="space-y-4">
              {users.map((user) => {
                const isProcessing = processingUsers.has(user.id)
                return (
                  <div
                    key={user.id}
                    className="flex items-start justify-between border-b pb-4 last:border-0 last:pb-0"
                  >
                    <div className="flex-1">
                      <p className="text-sm font-medium text-gray-900">{user.name}</p>
                      <p className="text-xs text-gray-500">{user.email}</p>
                      {user.organization && (
                        <p className="text-xs text-gray-400 mt-0.5">{user.organization}</p>
                      )}
                      <span className="text-xs text-gray-400 mt-1 block">
                        {getTimeAgo(user.created_at)}
                      </span>
                    </div>
                    <div className="ml-4 flex flex-col gap-2">
                      <Button
                        size="sm"
                        variant="default"
                        className="gap-1 bg-green-600 hover:bg-green-700"
                        onClick={() => handleApproveUser(user.id, user.name)}
                        disabled={isProcessing}
                      >
                        <Check className="h-3 w-3" />
                        ìŠ¹ì¸
                      </Button>
                      <Button
                        size="sm"
                        variant="outline"
                        className="gap-1 text-red-600 hover:bg-red-50"
                        onClick={() => handleRejectUser(user.id, user.name)}
                        disabled={isProcessing}
                      >
                        <X className="h-3 w-3" />
                        ê±°ë¶€
                      </Button>
                    </div>
                  </div>
                )
              })}
            </div>

            {/* í˜ì´ì§€ë„¤ì´ì…˜ */}
            {totalPages > 1 && (
              <div className="mt-4 flex items-center justify-between border-t pt-4">
                <p className="text-sm text-gray-600">
                  {totalCount}ê±´ ì¤‘ {(page - 1) * pageSize + 1}-
                  {Math.min(page * pageSize, totalCount)}
                </p>
                <div className="flex gap-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handlePrevPage}
                    disabled={page === 1}
                  >
                    <ChevronLeft className="h-4 w-4" />
                  </Button>
                  <div className="flex items-center gap-1 px-2">
                    <span className="text-sm font-medium">{page}</span>
                    <span className="text-sm text-gray-500">/ {totalPages}</span>
                  </div>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handleNextPage}
                    disabled={page === totalPages}
                  >
                    <ChevronRight className="h-4 w-4" />
                  </Button>
                </div>
              </div>
            )}
          </>
        )}
      </CardContent>
    </Card>
  )
}
```

### 3ë‹¨ê³„: ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ë‹¨ìˆœí™”

#### 3.1 ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ìˆ˜ì •
**íŒŒì¼**: `app/admin/dashboard/page.tsx` (ìˆ˜ì •)

```typescript
'use client'

import { useAdminTitle } from '@/components/admin/layout/AdminContext'
import { DashboardStats } from '@/components/admin/dashboard/DashboardStats'
import { PendingContentsCard } from '@/components/admin/dashboard/PendingContentsCard'
import { PendingUsersCard } from '@/components/admin/dashboard/PendingUsersCard'

export default function AdminDashboardPage() {
  useAdminTitle('ëŒ€ì‹œë³´ë“œ')

  return (
    <div className="space-y-6">
      {/* í†µê³„ ì¹´ë“œ - ë…ë¦½ì  ë¡œë”© */}
      <DashboardStats />

      {/* ì‹¤ì‹œê°„ í™œë™ í”¼ë“œ - ê°ê° ë…ë¦½ì  ë¡œë”© */}
      <div className="grid gap-6 md:grid-cols-2">
        <PendingContentsCard />
        <PendingUsersCard />
      </div>
    </div>
  )
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš

### 1. ì»´í¬ë„ŒíŠ¸ë³„ ë…ë¦½ ë¡œë”© í…ŒìŠ¤íŠ¸
```typescript
test('ê° ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ë¡œë”©ë¨', async ({ page }) => {
  await page.goto('/admin/dashboard')

  // í†µê³„ ì¹´ë“œ ìŠ¤ì¼ˆë ˆí†¤ í™•ì¸
  const statsSkeletons = await page.locator('.grid > div .skeleton').count()
  expect(statsSkeletons).toBeGreaterThan(0)

  // ëŒ€ê¸°ì¤‘ ì½˜í…ì¸  ì¹´ë“œ ìŠ¤ì¼ˆë ˆí†¤ í™•ì¸
  await expect(page.locator('text=ìµœê·¼ ëŒ€ê¸°ì¤‘ì¸ ì½˜í…ì¸ ').locator('..').locator('.skeleton')).toBeVisible()

  // ê°€ì… ìš”ì²­ ì¹´ë“œ ìŠ¤ì¼ˆë ˆí†¤ í™•ì¸
  await expect(page.locator('text=ìµœê·¼ ê°€ì… ìš”ì²­').locator('..').locator('.skeleton')).toBeVisible()

  // ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ë¡œë”© ì™„ë£Œë¨
  await page.waitForTimeout(3000)
})
```

### 2. í˜ì´ì§€ë„¤ì´ì…˜ í…ŒìŠ¤íŠ¸
```typescript
test('ëŒ€ê¸°ì¤‘ ì½˜í…ì¸  í˜ì´ì§€ë„¤ì´ì…˜', async ({ page }) => {
  await page.goto('/admin/dashboard')

  // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ì´ ìˆëŠ” ê²½ìš°
  const nextButton = page.locator('text=ìµœê·¼ ëŒ€ê¸°ì¤‘ì¸ ì½˜í…ì¸ ').locator('..').locator('button:has-text("â€º")')

  if (await nextButton.isVisible()) {
    // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
    await nextButton.click()

    // í˜ì´ì§€ ë²ˆí˜¸ê°€ 2ë¡œ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
    await expect(page.locator('text=ìµœê·¼ ëŒ€ê¸°ì¤‘ì¸ ì½˜í…ì¸ ').locator('..').locator('text=/2/')).toBeVisible()
  }
})
```

### 3. ì‚¬ìš©ì ìŠ¹ì¸/ê±°ë¶€ í…ŒìŠ¤íŠ¸
```typescript
test('ê°€ì… ìš”ì²­ ìŠ¹ì¸', async ({ page }) => {
  await page.goto('/admin/dashboard')

  // ì²« ë²ˆì§¸ ìŠ¹ì¸ ë²„íŠ¼ í´ë¦­
  const approveButton = page.locator('text=ìµœê·¼ ê°€ì… ìš”ì²­').locator('..').locator('button:has-text("ìŠ¹ì¸")').first()

  if (await approveButton.isVisible()) {
    await approveButton.click()

    // ì„±ê³µ í† ìŠ¤íŠ¸ í™•ì¸
    await expect(page.locator('text=ìŠ¹ì¸ ì™„ë£Œ')).toBeVisible({ timeout: 5000 })

    // ì¹´ë“œê°€ ë‹¤ì‹œ ë¡œë”©ë˜ê³  í•´ë‹¹ ì‚¬ìš©ìê°€ ì œê±°ë˜ì—ˆëŠ”ì§€ í™•ì¸
    await page.waitForTimeout(1000)
  }
})
```

### 4. ìŠ¤ì¼ˆë ˆí†¤ UI í…ŒìŠ¤íŠ¸
```typescript
test('í†µê³„ ì¹´ë“œ ìˆ«ìë§Œ ìŠ¤ì¼ˆë ˆí†¤', async ({ page }) => {
  await page.goto('/admin/dashboard')

  // í†µê³„ ì¹´ë“œì—ì„œ ì œëª©ì€ ì¦‰ì‹œ í‘œì‹œë˜ê³ , ìˆ«ìë§Œ ìŠ¤ì¼ˆë ˆí†¤
  await expect(page.locator('text=ì´ ì½˜í…ì¸ ')).toBeVisible()
  await expect(page.locator('text=ëŒ€ê¸°ì¤‘')).toBeVisible()
  await expect(page.locator('text=ë¶„ì„ì¤‘')).toBeVisible()

  // ìˆ«ì ë¶€ë¶„ ìŠ¤ì¼ˆë ˆí†¤ í™•ì¸
  const statsSkeleton = await page.locator('.grid > div .skeleton').count()
  expect(statsSkeleton).toBe(5) // 5ê°œ í†µê³„ ì¹´ë“œ
})
```

## ğŸ“ ì£¼ìš” ë³€ê²½ì‚¬í•­ ìš”ì•½

### ì•„í‚¤í…ì²˜ ë³€ê²½
| í•­ëª© | ì´ì „ ë°©ì‹ | ìƒˆë¡œìš´ ë°©ì‹ |
|------|----------|------------|
| ë¡œë”© ë°©ì‹ | í˜ì´ì§€ ì „ì²´ ë¡œë”© | ì»´í¬ë„ŒíŠ¸ë³„ ë…ë¦½ ë¡œë”© |
| ë°ì´í„° ì¡°íšŒ | í•œ ë²ˆì— ëª¨ë“  ë°ì´í„° | ê° ì»´í¬ë„ŒíŠ¸ê°€ í•„ìš”í•œ ë°ì´í„°ë§Œ |
| ìŠ¤ì¼ˆë ˆí†¤ | í˜ì´ì§€ ì „ì²´ ìŠ¤ì¼ˆë ˆí†¤ | ì»´í¬ë„ŒíŠ¸ë³„ ìŠ¤ì¼ˆë ˆí†¤ |
| í˜ì´ì§€ë„¤ì´ì…˜ | limitë§Œ ì ìš© | 10ê°œì”© í˜ì´ì§€ë„¤ì´ì…˜ |

### ìƒˆë¡œ ìƒì„±í•  íŒŒì¼
1. `lib/api/dashboard.ts` - í†µê³„ ì¡°íšŒ í•¨ìˆ˜
2. `components/admin/dashboard/DashboardStats.tsx` - í†µê³„ ì¹´ë“œ ì»¨í…Œì´ë„ˆ
3. `components/admin/dashboard/PendingContentsCard.tsx` - ëŒ€ê¸°ì¤‘ ì½˜í…ì¸  ì¹´ë“œ
4. `components/admin/dashboard/PendingUsersCard.tsx` - ê°€ì… ìš”ì²­ ì¹´ë“œ

### ìˆ˜ì •í•  íŒŒì¼
1. `components/admin/dashboard/StatsCard.tsx` - isLoading prop ì¶”ê°€
2. `app/admin/dashboard/page.tsx` - ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ë¡œ êµì²´
3. ~~`components/admin/dashboard/ActivityFeed.tsx`~~ - **ì œê±° (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)**

### ì¬ì‚¬ìš©í•˜ëŠ” ê¸°ì¡´ í•¨ìˆ˜
- âœ… `getUsersWithPagination()` - ê°€ì… ìš”ì²­ í˜ì´ì§€ë„¤ì´ì…˜
- âœ… `getContentsWithPagination()` - ëŒ€ê¸°ì¤‘ ì½˜í…ì¸  í˜ì´ì§€ë„¤ì´ì…˜
- âœ… `updateUserApproval()` - ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬

## ğŸš€ êµ¬í˜„ ìˆœì„œ

1. **lib/api/dashboard.ts** ìƒì„± ë° getDashboardStats êµ¬í˜„
2. **StatsCard.tsx** ìˆ˜ì • (isLoading prop ì¶”ê°€)
3. **DashboardStats.tsx** ìƒì„±
4. **PendingContentsCard.tsx** ìƒì„±
5. **PendingUsersCard.tsx** ìƒì„±
6. **app/admin/dashboard/page.tsx** ìˆ˜ì •
7. TypeScript íƒ€ì… ì—ëŸ¬ ê²€ì‚¬
8. Playwright í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰
9. ìˆ˜ë™ í…ŒìŠ¤íŠ¸ (ê° ì»´í¬ë„ŒíŠ¸ ë…ë¦½ ë¡œë”© í™•ì¸)

## ğŸ“Œ ì£¼ì˜ì‚¬í•­

### 1. ì„±ëŠ¥ ìµœì í™”
- **ë³‘ë ¬ ì¿¼ë¦¬**: getDashboardStatsëŠ” 5ê°œ ì¿¼ë¦¬ë¥¼ ë³‘ë ¬ ì‹¤í–‰
- **ë…ë¦½ì  ë¡œë”©**: ê° ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ë¡œë”©ë˜ì–´ ì „ì²´ í˜ì´ì§€ ë¸”ë¡œí‚¹ ë°©ì§€
- **í˜ì´ì§€ë„¤ì´ì…˜**: 10ê°œì”© ë‚˜ëˆ„ì–´ ë¡œë”©í•˜ì—¬ ì´ˆê¸° ë¡œë”© ì†ë„ ê°œì„ 

### 2. UX ê°œì„ 
- **ìŠ¤ì¼ˆë ˆí†¤ UI**: ë¡œë”© ì¤‘ ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ í”¼ë“œë°±
- **í†µê³„ ì¹´ë“œ**: ìˆ«ìë§Œ ìŠ¤ì¼ˆë ˆí†¤ ì²˜ë¦¬í•˜ì—¬ ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ìµœì†Œí™”
- **ì¦‰ì‹œ í”¼ë“œë°±**: ìŠ¹ì¸/ê±°ë¶€ í›„ ì¦‰ì‹œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨

### 3. ì—ëŸ¬ ì²˜ë¦¬
- ê° ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ì—ëŸ¬ ì²˜ë¦¬
- í•œ ì»´í¬ë„ŒíŠ¸ì˜ ì—ëŸ¬ê°€ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì— ì˜í–¥ ì—†ìŒ
- ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

### 4. ë³´ì•ˆ
- RLS ì •ì±…ìœ¼ë¡œ ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- JWT Claims ê¸°ë°˜ ê¶Œí•œ í™•ì¸
- ì¤‘ë³µ í´ë¦­ ë°©ì§€ (processingUsers Set)

## ğŸ” ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `lib/api/dashboard.ts` íŒŒì¼ ìƒì„± ë° í•¨ìˆ˜ êµ¬í˜„
- [ ] `components/admin/dashboard/DashboardStats.tsx` ìƒì„±
- [ ] `components/admin/dashboard/PendingContentsCard.tsx` ìƒì„±
- [ ] `components/admin/dashboard/PendingUsersCard.tsx` ìƒì„±
- [ ] `components/admin/dashboard/StatsCard.tsx` ìˆ˜ì •
- [ ] `app/admin/dashboard/page.tsx` ìˆ˜ì •
- [ ] `components/admin/dashboard/ActivityFeed.tsx` ì œê±° (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
- [ ] TypeScript íƒ€ì… ì—ëŸ¬ ì—†ìŒ
- [ ] ê° ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ë¡œë”©ë˜ëŠ”ì§€ í™•ì¸
- [ ] ìŠ¤ì¼ˆë ˆí†¤ UI ì •ìƒ ì‘ë™ í™•ì¸
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] ìŠ¹ì¸/ê±°ë¶€ ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] Playwright í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼
- [ ] í”„ë¡œë•ì…˜ ë°°í¬

---

**ì‘ì„±ì¼**: 2025-11-04 (ìˆ˜ì •)
**ë¬¸ì„œ ë²ˆí˜¸**: 031 (ê°œì •íŒ)
**ë‹´ë‹¹**: Claude Code
**ìƒíƒœ**: ê³„íš ìˆ˜ì • ì™„ë£Œ
