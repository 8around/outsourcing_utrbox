# 콘텐츠 상세 페이지 레이아웃 개선 계획

## 📋 개요

### 목적
사용자용 콘텐츠 상세 페이지의 UI/UX를 개선하여 분석결과와 발견내역을 더 효과적으로 표시하고, 보안을 강화합니다.

### 배경
- 현재 3열 레이아웃이 정보를 분산시켜 사용성 저하
- 사용자가 관리자 검토 상태를 변경할 수 있는 보안 문제
- 발견내역이 그룹화되지 않아 가독성 저하
- 감지된 이미지를 직접 확인하기 어려움

### 변경 범위
- **파일**: `app/(user)/contents/[id]/page.tsx`
- **타입**: UI/UX 개선, 보안 강화
- **난이도**: 중

---

## 🎯 주요 변경사항

### 1. 레이아웃 재구성

#### 현재 구조 (3열)
```
┌─────────────────────────────────────────────────────┐
│                    Header                            │
├───────────────────────────────┬─────────────────────┤
│ 왼쪽 2열                       │ 오른쪽 1열          │
│ ┌─────────────────────────┐   │ ┌─────────────────┐ │
│ │ 원본 이미지              │   │ │ 빠른 통계       │ │
│ └─────────────────────────┘   │ └─────────────────┘ │
│ ┌─────────────────────────┐   │ ┌─────────────────┐ │
│ │ Tabs                    │   │ │ 작업            │ │
│ │ ┌─────────────────────┐ │   │ └─────────────────┘ │
│ │ │ 정보 탭             │ │   │                     │
│ │ │ - 파일명           │ │   │                     │
│ │ │ - 업로드날짜       │ │   │                     │
│ │ │ - 파일형식         │ │   │                     │
│ │ │ - 파일크기         │ │   │                     │
│ │ │ - 분석상태         │ │   │                     │
│ │ └─────────────────────┘ │   │                     │
│ │ [분석결과 탭]           │   │                     │
│ │ [발견내역 탭]           │   │                     │
│ └─────────────────────────┘   │                     │
└───────────────────────────────┴─────────────────────┘
```

#### 새로운 구조 (2열)
```
┌─────────────────────────────────────────────────────┐
│                    Header                            │
├───────────────────────────────┬─────────────────────┤
│ 왼쪽 절반                      │ 오른쪽 절반          │
│                               │                     │
│ ┌─────────────────────────┐   │ ┌─────────────────┐ │
│ │ 원본 이미지              │   │ │ 감지 이미지     │ │
│ └─────────────────────────┘   │ │ (선택된 항목)   │ │
│                               │ └─────────────────┘ │
│ ┌─────────────────────────┐   │                     │
│ │ 분석결과                │   │ ┌─────────────────┐ │
│ │                         │   │ │ 발견내역        │ │
│ │ ■ 파일명 (유지)         │   │ │                 │ │
│ │                         │   │ │ ■ 일치 (3)      │ │
│ │ ■ 분석결과 통합:        │   │ │   - 항목1       │ │
│ │   - 감지된 레이블       │   │ │   - 항목2       │ │
│ │   - 감지된 텍스트       │   │ │                 │ │
│ │   - 발견 통계           │   │ │ ■ 부분일치 (5)  │ │
│ │                         │   │ │   - 항목1       │ │
│ │ (파일 상세 정보 제거)   │   │ │                 │ │
│ └─────────────────────────┘   │ │ ■ 유사 (2)      │ │
│                               │ └─────────────────┘ │
└───────────────────────────────┴─────────────────────┘
```

### 2. 왼쪽 절반 - 분석결과 Card 재구성

#### 제거할 요소 (정보 탭 내)
현재 313-363 라인의 파일 상세 정보:
- ❌ 업로드 날짜 (Calendar 아이콘)
- ❌ 파일 형식 (FileType 아이콘)
- ❌ 파일 크기 (HardDrive 아이콘)
- ❌ 분석 상태 (Tag 아이콘)

#### 유지할 요소
- ✅ 파일명 (`<h2>{content.file_name}</h2>`)
- ✅ 메시지 (`content.message`)

#### 추가할 요소 (파일 상세 정보 자리에)
기존 "분석결과" 탭(365-424 라인)의 내용을 이동:
- 감지된 레이블 (labels)
- 감지된 텍스트 (texts)
- 발견 통계 (일치/부분일치/유사 개수)

#### 최종 구조
```tsx
<Card className="p-6">
  {/* 파일명 - 유지 */}
  <div className="mb-6">
    <h2 className="text-2xl font-bold">{content.file_name}</h2>
    {content.message && (
      <p className="text-secondary-500 mt-2">{content.message}</p>
    )}
  </div>

  {/* 분석결과 통합 - 기존 "분석결과 탭" 내용 이동 */}
  <div className="space-y-4">
    {/* 감지된 레이블 */}
    {analysisResult?.labels.length > 0 && (
      <div>
        <h3 className="mb-3 font-semibold">감지된 레이블</h3>
        <div className="flex flex-wrap gap-2">
          {analysisResult.labels.map((label, index) => (
            <Badge key={index} variant="secondary">
              {label.description} ({(label.score * 100).toFixed(0)}%)
            </Badge>
          ))}
        </div>
      </div>
    )}

    {/* 감지된 텍스트 */}
    {analysisResult?.texts.length > 0 && (
      <div>
        <h3 className="mb-3 font-semibold">감지된 텍스트</h3>
        <div className="space-y-2">
          {analysisResult.texts.map((text, index) => (
            <Card key={index} className="p-3">
              <p className="text-sm">{text.description}</p>
            </Card>
          ))}
        </div>
      </div>
    )}

    {/* 발견 통계 */}
    <div>
      <h3 className="mb-3 font-semibold">발견 통계</h3>
      <div className="grid gap-4 sm:grid-cols-3">
        <Card className="p-4">
          <p className="text-secondary-500 text-sm">완전 일치</p>
          <p className="mt-1 text-2xl font-bold">
            {analysisResult?.full_matching_images.length || 0}
          </p>
        </Card>
        <Card className="p-4">
          <p className="text-secondary-500 text-sm">부분 일치</p>
          <p className="mt-1 text-2xl font-bold">
            {analysisResult?.partial_matching_images.length || 0}
          </p>
        </Card>
        <Card className="p-4">
          <p className="text-secondary-500 text-sm">유사 이미지</p>
          <p className="mt-1 text-2xl font-bold">
            {analysisResult?.similar_images.length || 0}
          </p>
        </Card>
      </div>
    </div>
  </div>
</Card>
```

### 3. 오른쪽 절반 구성

#### 감지 이미지 영역 (신규)
```tsx
<Card className="overflow-hidden">
  <div className="bg-secondary-100 relative aspect-video flex items-center justify-center">
    {selectedDetection ? (
      <img
        src={selectedDetection.image_url}
        alt="감지된 이미지"
        className="h-full w-full object-contain"
        onError={(e) => {
          e.currentTarget.src = '/placeholder-image.png'
        }}
      />
    ) : (
      <div className="text-center text-secondary-400 p-8">
        <FileImage className="mx-auto mb-3 h-12 w-12" />
        <p className="font-medium">선택된 이미지가 없습니다</p>
        <p className="text-sm mt-1">발견내역을 클릭하여 이미지를 확인하세요</p>
      </div>
    )}
  </div>
</Card>
```

#### 발견내역 그룹화 리스트 (재구성)

**현재 문제**:
- 발견내역이 평면 리스트로 표시됨
- detection_type별 구분 없음
- 사용자가 검토 상태 변경 가능 (Select 존재)

**변경 후**:
```tsx
<Card className="p-6">
  <h3 className="font-semibold mb-4">발견 내역</h3>

  {detectedContents.length > 0 ? (
    <div className="space-y-6">
      {/* 일치 그룹 */}
      {groupedDetections.full.length > 0 && (
        <div>
          <h4 className="text-sm font-semibold mb-3 flex items-center gap-2">
            <span className="inline-block w-3 h-3 bg-error rounded-full"></span>
            일치 ({groupedDetections.full.length})
          </h4>
          <div className="space-y-2">
            {groupedDetections.full.map(detection => (
              <button
                key={detection.id}
                onClick={() => handleDetectionClick(detection)}
                className={cn(
                  "w-full text-left p-4 rounded-lg border transition-all",
                  selectedDetection?.id === detection.id
                    ? "border-primary bg-primary/5 shadow-sm"
                    : "border-secondary-200 hover:border-secondary-300 hover:bg-secondary-50"
                )}
              >
                <div className="flex gap-4">
                  <div className="bg-secondary-100 flex h-20 w-20 flex-shrink-0 items-center justify-center rounded">
                    <FileImage className="text-secondary-400 h-8 w-8" />
                  </div>
                  <div className="min-w-0 flex-1">
                    <a
                      href={detection.source_url || '#'}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="flex items-center gap-1 text-primary hover:underline"
                      onClick={(e) => e.stopPropagation()}
                    >
                      <span className="truncate">
                        {detection.page_title || detection.source_url || '출처 정보 없음'}
                      </span>
                      <ExternalLink className="h-3 w-3 flex-shrink-0" />
                    </a>
                    <p className="text-secondary-500 mt-1 text-sm">
                      발견일: {format(new Date(detection.created_at), 'yyyy.MM.dd', { locale: ko })}
                    </p>
                    {/* 읽기 전용 Badge */}
                    <Badge
                      variant="secondary"
                      className={cn("mt-2", getReviewStatusColor(detection.admin_review_status))}
                    >
                      {getReviewStatusText(detection.admin_review_status)}
                    </Badge>
                  </div>
                </div>
              </button>
            ))}
          </div>
        </div>
      )}

      {/* 부분일치 그룹 */}
      {groupedDetections.partial.length > 0 && (
        <div>
          <h4 className="text-sm font-semibold mb-3 flex items-center gap-2">
            <span className="inline-block w-3 h-3 bg-warning rounded-full"></span>
            부분일치 ({groupedDetections.partial.length})
          </h4>
          {/* 동일한 구조 */}
        </div>
      )}

      {/* 유사 그룹 */}
      {groupedDetections.similar.length > 0 && (
        <div>
          <h4 className="text-sm font-semibold mb-3 flex items-center gap-2">
            <span className="inline-block w-3 h-3 bg-primary rounded-full"></span>
            유사 ({groupedDetections.similar.length})
          </h4>
          {/* 동일한 구조 */}
        </div>
      )}
    </div>
  ) : (
    <div className="text-secondary-500 py-12 text-center">
      <CheckCircle2 className="text-success mx-auto mb-3 h-12 w-12" />
      <p>발견된 침해 콘텐츠가 없습니다</p>
    </div>
  )}
</Card>
```

### 4. 제거할 요소

#### 사이드바 전체 (494-549 라인)
- ❌ 빠른 통계 (Quick Stats) - 분석결과에 통합
- ❌ 작업 (Actions) - 헤더에 다운로드 버튼 존재

#### Tabs 구조 (306-490 라인)
- ❌ `<Tabs>`, `<TabsList>`, `<TabsTrigger>` 제거
- ❌ `<TabsContent value="analysis">` 제거 (내용은 정보 섹션으로 이동)
- ❌ `<TabsContent value="detections">` 제거 (내용은 오른쪽으로 분리)

#### 검토 상태 변경 기능
- ❌ `handleReviewUpdate` 함수 (206-219 라인)
- ❌ `Select` 컴포넌트 (462-476 라인)
- ✅ 읽기 전용 `Badge`만 유지

---

## 🔧 기술 구현

### 1. State 추가

```typescript
const [selectedDetection, setSelectedDetection] = useState<DetectedContent | null>(null)
```

### 2. 함수 변경

#### 제거
```typescript
// 206-219 라인
const handleReviewUpdate = async (detectionId: string, reviewStatus: string) => {
  // 사용자는 검토 상태를 변경할 수 없음 - 삭제
}
```

#### 추가
```typescript
const handleDetectionClick = (detection: DetectedContent) => {
  setSelectedDetection(detection)
}
```

### 3. 그룹화 로직 추가

```typescript
// detectedContents를 detection_type별로 그룹화
const groupedDetections = {
  full: detectedContents.filter(d => d.detection_type === 'full'),
  partial: detectedContents.filter(d => d.detection_type === 'partial'),
  similar: detectedContents.filter(d => d.detection_type === 'similar')
}
```

### 4. 레이아웃 변경

```typescript
// Before: lg:grid-cols-3
<div className="grid gap-6 lg:grid-cols-3">
  <div className="space-y-6 lg:col-span-2">...</div>
  <div className="space-y-6">...</div> {/* 사이드바 */}
</div>

// After: lg:grid-cols-2
<div className="grid gap-6 lg:grid-cols-2">
  <div className="space-y-6">...</div> {/* 왼쪽 */}
  <div className="space-y-6">...</div> {/* 오른쪽 */}
</div>
```

---

## ✅ 테스트 계획

### Playwright 테스트 시나리오

#### 1. 레이아웃 검증
```typescript
test('2열 레이아웃 및 사이드바 제거 확인', async ({ page }) => {
  await page.goto('/contents/test-id')

  const grid = page.locator('.grid.lg\\:grid-cols-2')
  await expect(grid).toBeVisible()

  await expect(page.getByText('빠른 통계')).not.toBeVisible()
  await expect(page.getByText('작업')).not.toBeVisible()
})
```

#### 2. 분석결과 통합 확인
```typescript
test('파일명과 분석결과가 통합 표시', async ({ page }) => {
  await page.goto('/contents/test-id')

  // 파일명 유지 확인
  await expect(page.getByRole('heading', { level: 2 })).toBeVisible()

  // 분석결과 표시 확인
  await expect(page.getByText('감지된 레이블')).toBeVisible()
  await expect(page.getByText('감지된 텍스트')).toBeVisible()
  await expect(page.getByText('발견 통계')).toBeVisible()

  // 파일 상세 정보 제거 확인
  await expect(page.getByText('업로드 날짜')).not.toBeVisible()
  await expect(page.getByText('파일 형식')).not.toBeVisible()
  await expect(page.getByText('파일 크기')).not.toBeVisible()
  await expect(page.getByText('분석 상태')).not.toBeVisible()

  // Tabs 제거 확인
  await expect(page.getByRole('tab')).not.toBeVisible()
})
```

#### 3. 발견내역 그룹화 확인
```typescript
test('발견내역이 그룹화되어 표시', async ({ page }) => {
  await page.goto('/contents/test-id')

  await expect(page.getByText(/일치 \(\d+\)/)).toBeVisible()
  await expect(page.getByText(/부분일치 \(\d+\)/)).toBeVisible()
  await expect(page.getByText(/유사 \(\d+\)/)).toBeVisible()
})
```

#### 4. 감지 이미지 표시 확인
```typescript
test('발견내역 클릭 시 감지 이미지 표시', async ({ page }) => {
  await page.goto('/contents/test-id')

  await expect(page.getByText('선택된 이미지가 없습니다')).toBeVisible()

  const firstItem = page.locator('button').filter({ hasText: '출처' }).first()
  await firstItem.click()

  await expect(page.getByText('선택된 이미지가 없습니다')).not.toBeVisible()
  await expect(page.getByAltText('감지된 이미지')).toBeVisible()
})
```

#### 5. 읽기 전용 확인
```typescript
test('검토 상태 Select 제거 확인', async ({ page }) => {
  await page.goto('/contents/test-id')

  await expect(page.getByRole('combobox')).not.toBeVisible()
  await expect(page.locator('[class*="badge"]').first()).toBeVisible()
})
```

---

## 📝 구현 체크리스트

### Phase 1: State 및 함수
- [ ] `selectedDetection` state 추가
- [ ] `handleDetectionClick` 함수 추가
- [ ] `handleReviewUpdate` 함수 제거
- [ ] `groupedDetections` 계산 로직 추가

### Phase 2: 레이아웃 변경
- [ ] `lg:grid-cols-3` → `lg:grid-cols-2` 변경
- [ ] 사이드바 섹션 제거 (494-549 라인)

### Phase 3: 왼쪽 - 분석결과 통합
- [ ] Tabs 구조 제거
- [ ] 파일명 유지
- [ ] 파일 상세 정보 제거 (Calendar, FileType, HardDrive, Tag)
- [ ] 분석결과 내용 이동 (labels, texts, 통계)

### Phase 4: 오른쪽 - 감지 이미지 + 발견내역
- [ ] 감지 이미지 영역 추가
- [ ] placeholder 구현
- [ ] 발견내역 그룹화 구현
- [ ] Select 제거, Badge로 대체

### Phase 5: 테스트
- [ ] Playwright 테스트 실행
- [ ] 모든 테스트 통과 확인

---

## ⚠️ 주의사항

1. **보안**: Select 컴포넌트와 handleReviewUpdate 완전 제거
2. **UX**: placeholder 메시지 명확하게
3. **반응형**: 모바일에서 세로 스택
4. **성능**: groupedDetections는 useMemo 고려

---

_작성일: 2025-10-27_
_상태: 승인됨_
