# 036. ì´ë©”ì¼ ì¬ì „ì†¡ ê¸°ëŠ¥ êµ¬í˜„ ê³„íš (Plan B - Resend Method)

## ğŸ“‹ ê°œìš”

Supabase ê°€ì… ì´ë©”ì¼ ì¬ì „ì†¡ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤. Supabaseì˜ ê³µì‹ `auth.resend()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ íšŒì›ê°€ì… ì¸ì¦ ì´ë©”ì¼ì„ ì¬ì „ì†¡í•˜ë©°, SupabaseëŠ” ìì²´ì ìœ¼ë¡œ ê°™ì€ ì´ë©”ì¼ì— ëŒ€í•œ ìµœì†Œ ì¬ìš”ì²­ ì‹œê°„ìœ¼ë¡œ 1ë¶„ì„ ì œí•œí•˜ë¯€ë¡œ, ë³„ë„ì˜ í´ë¼ì´ì–¸íŠ¸ ì¿¨ë‹¤ìš´ì€ êµ¬í˜„í•˜ì§€ ì•Šê³  AuthErrorë¥¼ í†µí•´ ì‚¬ìš©ìì—ê²Œ ì ì ˆí•œ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ¯ ëª©í‘œ

1. **ì´ë©”ì¼ ì¬ì „ì†¡ API êµ¬í˜„**: `auth.resend()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ì¬ì „ì†¡ ë¡œì§
2. **í†µí•© ì—ëŸ¬ ì²˜ë¦¬**: AuthErrorì˜ code ê¸°ë°˜ ë©”ì‹œì§€ ë§¤í•‘ ì‹œìŠ¤í…œ êµ¬ì¶•
3. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ì™€ ì¬ì „ì†¡ ë²„íŠ¼ í™œì„±í™”
4. **ì½”ë“œ ì¼ê´€ì„±**: ëª¨ë“  auth ê´€ë ¨ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í†µí•©ëœ ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬

## ğŸ” í˜„ì¬ ìƒíƒœ ë¶„ì„

### ê¸°ì¡´ êµ¬ì¡°
```
1. app/api/auth/verify/route.ts
   - getErrorMessage() í•¨ìˆ˜ë¡œ AuthError code â†’ í•œêµ­ì–´ ë©”ì‹œì§€ ë§¤í•‘
   - 12ê°œì˜ ì—ëŸ¬ ì½”ë“œ ì²˜ë¦¬

2. lib/utils/errors.ts
   - handleAuthError() í•¨ìˆ˜ëŠ” AuthError.message ê¸°ë°˜ ë§¤í•‘ (êµ¬ì‹)
   - formatApiError() í•¨ìˆ˜ê°€ handleAuthErrorë¥¼ ì‚¬ìš©

3. components/auth/LoginForm.tsx
   - handleResendEmail() í•¨ìˆ˜ëŠ” placeholder êµ¬í˜„ë§Œ ì¡´ì¬
   - ì‹¤ì œ API í˜¸ì¶œ ë¡œì§ ì—†ìŒ

4. components/auth/SignupForm.tsx
   - íšŒì›ê°€ì… ì„±ê³µ ì‹œ Dialog í‘œì‹œ
   - ì¬ì „ì†¡ ë²„íŠ¼ ì—†ìŒ (í•„ìš”)
```

### ë¬¸ì œì 
- âŒ AuthError.message ê¸°ë°˜ ì—ëŸ¬ ì²˜ë¦¬ëŠ” ë¶ˆì•ˆì • (ë©”ì‹œì§€ëŠ” ë³€ê²½ë  ìˆ˜ ìˆìŒ)
- âŒ ì—ëŸ¬ ì½”ë“œ ê¸°ë°˜ ì²˜ë¦¬ê°€ ë¶„ì‚°ë˜ì–´ ìˆìŒ
- âŒ ì¬ì „ì†¡ APIê°€ êµ¬í˜„ë˜ì§€ ì•ŠìŒ
- âŒ íšŒì›ê°€ì… í›„ ì´ë©”ì¼ì„ ëª» ë°›ì€ ê²½ìš° ëŒ€ì‘ ë°©ë²• ì—†ìŒ

## ğŸ“š Supabase ì¬ì „ì†¡ êµ¬í˜„ ë°©ë²•

### auth.resend()ë¥¼ ì‚¬ìš©í•œ ì¬ì „ì†¡
```typescript
// Supabaseì˜ ê³µì‹ resend ë©”ì„œë“œë¡œ signup confirmation email ì¬ì „ì†¡
const { error } = await supabase.auth.resend({
  type: 'signup',
  email: 'user@example.com'
  // emailRedirectTo ì˜µì…˜ ë¶ˆí•„ìš” - Supabase Dashboardì˜
  // ì´ë©”ì¼ í…œí”Œë¦¿ì—ì„œ ì´ë¯¸ /api/auth/verifyë¡œ ì„¤ì •ë¨
})
```

### resend vs signInWithOtp ì°¨ì´ì 
- **resend()**: ì´ˆê¸° íšŒì›ê°€ì… í™•ì¸ ì´ë©”ì¼ ì¬ì „ì†¡ ì „ìš©
- **signInWithOtp()**: ì´ë¯¸ í™•ì¸ëœ ê¸°ì¡´ ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ OTP ì „ì†¡ìš©
- íšŒì›ê°€ì… í›„ ë¯¸í™•ì¸ ì‚¬ìš©ìëŠ” ë°˜ë“œì‹œ `resend()`ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨

### ì´ë©”ì¼ í…œí”Œë¦¿ ì„¤ì •
- Supabase Dashboardì—ì„œ ì´ë¯¸ ì»¤ìŠ¤í…€ í…œí”Œë¦¿ ì„¤ì • ì™„ë£Œ
- í…œí”Œë¦¿ ë‚´ ë§í¬: `{{ .SiteURL }}/api/auth/verify?token_hash={{ .TokenHash }}&type=email`
- `emailRedirectTo` ì˜µì…˜ ì—†ì´ë„ ìë™ìœ¼ë¡œ ì»¤ìŠ¤í…€ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

### ì£¼ìš” ì—ëŸ¬ ì½”ë“œ (ì¬ì „ì†¡ ê´€ë ¨)
| ì—ëŸ¬ ì½”ë“œ | ì„¤ëª… | ì‚¬ìš©ì ë©”ì‹œì§€ |
|----------|------|--------------|
| `over_email_send_rate_limit` | ì´ë©”ì¼ ì „ì†¡ ì œí•œ ì´ˆê³¼ | ë„ˆë¬´ ë§ì€ ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. |
| `over_request_rate_limit` | ìš”ì²­ íšŸìˆ˜ ì œí•œ ì´ˆê³¼ | ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”. |
| `otp_expired` | OTP ë§Œë£Œ | ì¸ì¦ ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. |
| `otp_disabled` | OTP ë¹„í™œì„±í™” | OTP ì¸ì¦ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. |
| `email_not_confirmed` | ì´ë©”ì¼ ë¯¸ì¸ì¦ | ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. |
| `user_not_found` | ì‚¬ìš©ì ì—†ìŒ | ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤. |

## ğŸ› ï¸ êµ¬í˜„ ê³„íš

### 1ë‹¨ê³„: ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ í†µí•©

#### 1.1 lib/utils/errors.ts ë¦¬íŒ©í† ë§
```typescript
import { AuthError } from '@supabase/supabase-js'

// AuthError code ê¸°ë°˜ ë©”ì‹œì§€ ë§¤í•‘
const authErrorMessages: Record<string, string> = {
  // ì´ë©”ì¼ ì¸ì¦ ê´€ë ¨
  'otp_expired': 'ì¸ì¦ ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
  'otp_disabled': 'OTP ì¸ì¦ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
  'invalid_credentials': 'ì˜ëª»ëœ ì¸ì¦ ì •ë³´ì…ë‹ˆë‹¤.',
  'user_not_found': 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.',
  'email_not_confirmed': 'ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
  'email_exists': 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.',

  // Rate Limiting
  'over_email_send_rate_limit': 'ë„ˆë¬´ ë§ì€ ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
  'over_request_rate_limit': 'ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',

  // ì‹œìŠ¤í…œ ì—ëŸ¬
  'validation_failed': 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.',
  'unexpected_failure': 'ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
  'bad_code_verifier': 'ì¸ì¦ ì½”ë“œ ê²€ì¦ ì˜¤ë¥˜ì…ë‹ˆë‹¤.',
  'flow_state_expired': 'ì¸ì¦ ìš”ì²­ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
  'flow_state_not_found': 'ì¸ì¦ ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',

  // Provider ê´€ë ¨
  'email_provider_disabled': 'ì´ë©”ì¼ ì¸ì¦ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
  'provider_email_needs_verification': 'ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.',
}

export function handleAuthError(error: AuthError | Error | unknown): string {
  if (error instanceof AuthError) {
    // code ê¸°ë°˜ ì²˜ë¦¬ ìš°ì„ 
    if (error.code && authErrorMessages[error.code]) {
      return authErrorMessages[error.code]
    }

    // fallback: message ê¸°ë°˜ ì²˜ë¦¬
    // ê¸°ì¡´ message ê¸°ë°˜ ì²˜ë¦¬ëŠ” í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
    switch (error.message) {
      case 'Invalid login credentials':
        return 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'
      // ... ê¸°ì¡´ ì¼€ì´ìŠ¤ë“¤
      default:
        return error.message || 'ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
    }
  }

  if (error instanceof Error) {
    return error.message
  }

  return 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
}

// formatApiErrorëŠ” ë³€ê²½ ì—†ìŒ (handleAuthError ì‚¬ìš©)
export function formatApiError(error: AuthError): {
  success: false
  data: null
  error: string
  code?: string  // error code ì¶”ê°€
} {
  return {
    success: false,
    data: null,
    error: handleAuthError(error),
    code: error instanceof AuthError ? error.code : undefined
  }
}
```

### 2ë‹¨ê³„: verify ë¼ìš°íŠ¸ ìˆ˜ì •

#### 2.1 app/api/auth/verify/route.ts
```typescript
import { NextRequest, NextResponse } from 'next/server'
import { createServerSupabase } from '@/lib/supabase/server'
import { formatApiError } from '@/lib/utils/errors'  // í†µí•©ëœ ì—ëŸ¬ ì²˜ë¦¬ ì‚¬ìš©

type EmailOtpType = 'email' | 'recovery' | 'invite' | 'email_change'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)
    const token_hash = searchParams.get('token_hash')
    const type = searchParams.get('type') as EmailOtpType | null

    if (!token_hash || !type) {
      // validation_failed ì—ëŸ¬ë¡œ í†µì¼
      return NextResponse.redirect(
        new URL(
          `/login?verified=error&code=validation_failed&message=${encodeURIComponent('ì˜ëª»ëœ ì¸ì¦ ë§í¬ì…ë‹ˆë‹¤.')}`,
          request.url
        )
      )
    }

    const supabase = createServerSupabase()
    const { data: { session }, error } = await supabase.auth.verifyOtp({
      token_hash,
      type,
    })

    if (error) {
      console.error('Email verification error:', error)

      // formatApiError ì‚¬ìš©í•˜ì—¬ í†µí•©ëœ ì—ëŸ¬ ì²˜ë¦¬
      const errorResponse = formatApiError(error)
      return NextResponse.redirect(
        new URL(
          `/login?verified=error&code=${error.code || 'unknown'}&message=${encodeURIComponent(errorResponse.error)}`,
          request.url
        )
      )
    }

    // ì„±ê³µ: ì„¸ì…˜ ì œê±° (ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸°)
    if (session) {
      await supabase.auth.signOut()
      console.log('Email verified successfully, session removed for admin approval')
    }

    const successMessage = 'ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
    return NextResponse.redirect(
      new URL(
        `/login?verified=success&message=${encodeURIComponent(successMessage)}`,
        request.url
      )
    )
  } catch (error) {
    console.error('Email verification unexpected error:', error)

    return NextResponse.redirect(
      new URL(
        `/login?verified=error&code=unexpected_failure&message=${encodeURIComponent('ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')}`,
        request.url
      )
    )
  }
}
```

### 3ë‹¨ê³„: ì¬ì „ì†¡ API êµ¬í˜„

#### 3.1 app/api/auth/resend-verification/route.ts (ì‹ ê·œ)
```typescript
import { NextRequest, NextResponse } from 'next/server'
import { createServerSupabase } from '@/lib/supabase/server'
import { formatApiError } from '@/lib/utils/errors'

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    const { email } = body

    // ì´ë©”ì¼ ê²€ì¦
    if (!email || !email.includes('@')) {
      return NextResponse.json(
        {
          success: false,
          error: 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
          code: 'validation_failed'
        },
        { status: 400 }
      )
    }

    const supabase = createServerSupabase()

    // auth.resend()ë¥¼ ì‚¬ìš©í•˜ì—¬ signup confirmation email ì¬ì „ì†¡
    const { error } = await supabase.auth.resend({
      type: 'signup',
      email
      // emailRedirectTo ë¶ˆí•„ìš” - ì´ë©”ì¼ í…œí”Œë¦¿ì—ì„œ ì´ë¯¸ ì„¤ì •
    })

    if (error) {
      console.error('Resend verification error:', error)

      // formatApiErrorë¡œ í†µí•©ëœ ì—ëŸ¬ ë©”ì‹œì§€ ì‚¬ìš©
      const errorResponse = formatApiError(error)

      // Rate limit ì—ëŸ¬ëŠ” 429 ìƒíƒœ ì½”ë“œ
      const statusCode = error.code === 'over_email_send_rate_limit' ||
                        error.code === 'over_request_rate_limit' ? 429 : 400

      return NextResponse.json(errorResponse, { status: statusCode })
    }

    return NextResponse.json({
      success: true,
      message: 'ì¸ì¦ ë©”ì¼ì´ ì¬ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
    })
  } catch (error) {
    console.error('Resend email unexpected error:', error)

    return NextResponse.json(
      {
        success: false,
        error: 'ì´ë©”ì¼ ì¬ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
        code: 'unexpected_failure'
      },
      { status: 500 }
    )
  }
}
```

### 4ë‹¨ê³„: LoginForm ì¬ì „ì†¡ ê¸°ëŠ¥ ì—°ê²°

#### 4.1 components/auth/LoginForm.tsx ìˆ˜ì •
```typescript
// handleResendEmail í•¨ìˆ˜ ìˆ˜ì •
const handleResendEmail = async () => {
  // ì´ë©”ì¼ ì…ë ¥ í•„ìš” (formì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ ë³„ë„ ìƒíƒœ ê´€ë¦¬)
  const email = form.getValues('email')

  if (!email) {
    toast({
      variant: 'destructive',
      title: 'ì´ë©”ì¼ ì…ë ¥ í•„ìš”',
      description: 'ì¬ì „ì†¡í•  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
    })
    return
  }

  try {
    const response = await fetch('/api/auth/resend-verification', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ email }),
    })

    const result = await response.json()

    if (result.success) {
      toast({
        title: 'ì¬ì „ì†¡ ì™„ë£Œ',
        description: result.message,
      })
      setShowResendButton(false)
    } else {
      // ì—ëŸ¬ ì½”ë“œì— ë”°ë¥¸ ì²˜ë¦¬
      if (result.code === 'over_email_send_rate_limit') {
        toast({
          variant: 'destructive',
          title: 'ì¬ì „ì†¡ ì œí•œ',
          description: result.error,
        })
      } else {
        toast({
          variant: 'destructive',
          title: 'ì¬ì „ì†¡ ì‹¤íŒ¨',
          description: result.error,
        })
      }
    }
  } catch (error) {
    toast({
      variant: 'destructive',
      title: 'ì˜¤ë¥˜',
      description: 'ì´ë©”ì¼ ì¬ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
    })
  }
}
```

### 5ë‹¨ê³„: SignupFormì— ì¬ì „ì†¡ ë²„íŠ¼ ì¶”ê°€

#### 5.1 components/auth/SignupForm.tsx ìˆ˜ì •
```typescript
// Dialog ë‚´ìš© ìˆ˜ì •
<Dialog open={showSuccessDialog} onOpenChange={handleDialogClose}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>íšŒì›ê°€ì… ì™„ë£Œ</DialogTitle>
      <DialogDescription className="space-y-2 pt-2">
        <p>íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        <p>
          <span className="font-bold">ì´ë©”ì¼ ì¸ì¦</span> ë°{' '}
          <span className="font-bold">ê´€ë¦¬ì ìŠ¹ì¸</span> ì´í›„ ì„œë¹„ìŠ¤ ì´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </p>
        <p className="text-sm text-gray-500 mt-4">
          ì´ë©”ì¼ì„ ë°›ì§€ ëª»í•˜ì…¨ë‚˜ìš”?
        </p>
      </DialogDescription>
    </DialogHeader>
    <div className="flex gap-2">
      <Button
        variant="outline"
        onClick={handleResendEmail}
        disabled={isResending}
      >
        {isResending ? <LoadingSpinner size="sm" /> : 'ì¸ì¦ ë©”ì¼ ì¬ì „ì†¡'}
      </Button>
      <Button onClick={handleDialogClose}>í™•ì¸</Button>
    </div>
  </DialogContent>
</Dialog>
```

ì¶”ê°€ë¡œ ì¬ì „ì†¡ ë¡œì§ êµ¬í˜„:
```typescript
const [isResending, setIsResending] = useState(false)
const [userEmail, setUserEmail] = useState('')

// onSubmitì—ì„œ ì´ë©”ì¼ ì €ì¥
const onSubmit = async (data: SignupFormValues) => {
  setUserEmail(data.email)  // ì¬ì „ì†¡ì„ ìœ„í•´ ì´ë©”ì¼ ì €ì¥
  // ... ê¸°ì¡´ ì½”ë“œ
}

const handleResendEmail = async () => {
  if (!userEmail) return

  setIsResending(true)
  try {
    const response = await fetch('/api/auth/resend-verification', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ email: userEmail }),
    })

    const result = await response.json()

    if (result.success) {
      toast({
        title: 'ì¬ì „ì†¡ ì™„ë£Œ',
        description: result.message,
      })
    } else {
      toast({
        variant: 'destructive',
        title: 'ì¬ì „ì†¡ ì‹¤íŒ¨',
        description: result.error,
      })
    }
  } catch (error) {
    toast({
      variant: 'destructive',
      title: 'ì˜¤ë¥˜',
      description: 'ì´ë©”ì¼ ì¬ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
    })
  } finally {
    setIsResending(false)
  }
}
```

### 6ë‹¨ê³„: ê¸°ì¡´ formatApiError ì‚¬ìš©ì²˜ ê²€í† 

#### 6.1 lib/supabase/auth.ts í™•ì¸
- formatApiError ì‚¬ìš© ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
- error.code ì¶”ê°€ë¡œ ì¸í•œ íƒ€ì… ì—ëŸ¬ í™•ì¸

## ğŸ“‚ ìˆ˜ì •/ìƒì„± íŒŒì¼ ëª©ë¡

### ìˆ˜ì • íŒŒì¼
1. `lib/utils/errors.ts` - AuthError code ê¸°ë°˜ ë§¤í•‘ìœ¼ë¡œ ê°œì„ 
2. `app/api/auth/verify/route.ts` - formatApiError ì‚¬ìš©ìœ¼ë¡œ í†µì¼
3. `components/auth/LoginForm.tsx` - ì‹¤ì œ ì¬ì „ì†¡ API í˜¸ì¶œ êµ¬í˜„
4. `components/auth/SignupForm.tsx` - ì¬ì „ì†¡ ë²„íŠ¼ ì¶”ê°€

### ì‹ ê·œ íŒŒì¼
1. `app/api/auth/resend-verification/route.ts` - ì¬ì „ì†¡ API ì—”ë“œí¬ì¸íŠ¸

### ê²€í†  í•„ìš”
1. `lib/supabase/auth.ts` - formatApiError ì‚¬ìš© ë¶€ë¶„ í™•ì¸

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš

### 1. ì •ìƒ ì¬ì „ì†¡ í…ŒìŠ¤íŠ¸
```
1. íšŒì›ê°€ì… ì™„ë£Œ
2. Success Dialogì—ì„œ "ì¸ì¦ ë©”ì¼ ì¬ì „ì†¡" í´ë¦­
3. âœ… ì„±ê³µ toast í™•ì¸
4. ì´ë©”ì¼ ìˆ˜ì‹  í™•ì¸
```

### 2. Rate Limit í…ŒìŠ¤íŠ¸
```
1. ë™ì¼ ì´ë©”ì¼ë¡œ ì—°ì† ì¬ì „ì†¡ ìš”ì²­ (1ë¶„ ë‚´)
2. âŒ "ë„ˆë¬´ ë§ì€ ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í™•ì¸
3. 1ë¶„ í›„ ì¬ì‹œë„
4. âœ… ì •ìƒ ì¬ì „ì†¡ í™•ì¸
```

### 3. ì˜ëª»ëœ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸
```
1. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì¬ì „ì†¡ ë²„íŠ¼ í´ë¦­
2. ì´ë©”ì¼ ë¯¸ì…ë ¥ ìƒíƒœ
3. âŒ "ì´ë©”ì¼ ì…ë ¥ í•„ìš”" ë©”ì‹œì§€ í™•ì¸
```

### 4. ë¯¸ë“±ë¡ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸
```
1. ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ë¡œ ì¬ì „ì†¡ ì‹œë„
2. âŒ "ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤" ë©”ì‹œì§€ í™•ì¸
```

### 5. ì—ëŸ¬ ì½”ë“œ ë§¤í•‘ í…ŒìŠ¤íŠ¸
```
1. ê° ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
2. ì ì ˆí•œ í•œêµ­ì–´ ë©”ì‹œì§€ í‘œì‹œ í™•ì¸
3. error.codeê°€ ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### Rate Limiting
- Supabase ê¸°ë³¸ ì„¤ì •: ê°™ì€ ì´ë©”ì¼ 1ë¶„ ì œí•œ
- í´ë¼ì´ì–¸íŠ¸ ì¿¨ë‹¤ìš´ ë¶ˆí•„ìš” (ì„œë²„ê°€ ê´€ë¦¬)
- 429 ìƒíƒœ ì½”ë“œë¡œ ëª…í™•í•œ í”¼ë“œë°±

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- `shouldCreateUser: false`ë¡œ ê¸°ì¡´ ì‚¬ìš©ìë§Œ ëŒ€ìƒ
- ì´ë©”ì¼ ê²€ì¦ í•„ìˆ˜
- Rate limitìœ¼ë¡œ ë‚¨ìš© ë°©ì§€

### ì‚¬ìš©ì ê²½í—˜
- ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ (í•œêµ­ì–´)
- ì¬ì „ì†¡ ë²„íŠ¼ ì ì ˆí•œ ìœ„ì¹˜ì— ë°°ì¹˜
- ë¡œë”© ìƒíƒœ í‘œì‹œ

## ğŸ“Š ì˜ˆìƒ ì˜í–¥ë„

### ê¸ì •ì  ì˜í–¥
- âœ… ì´ë©”ì¼ ëª» ë°›ì€ ì‚¬ìš©ì ëŒ€ì‘ ê°€ëŠ¥
- âœ… í†µí•©ëœ ì—ëŸ¬ ì²˜ë¦¬ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- âœ… AuthError code ê¸°ë°˜ìœ¼ë¡œ ì•ˆì •ì„± ì¦ê°€
- âœ… ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

### ë³€ê²½ ë²”ìœ„
- ğŸŸ¡ **ì¤‘ê°„** - ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ ë¦¬íŒ©í† ë§
- ğŸŸ¢ ê¸°ì¡´ APIì™€ í˜¸í™˜ ìœ ì§€
- ğŸŸ¢ ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥

### ìœ„í—˜ë„
- ğŸŸ¢ **ë‚®ìŒ** - formatApiError í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
- ğŸŸ¢ Supabase ê³µì‹ ë°©ë²• ì‚¬ìš©
- ğŸŸ¢ ì¶©ë¶„í•œ ì—ëŸ¬ ì²˜ë¦¬

## ğŸš€ êµ¬í˜„ ìˆœì„œ

1. **Phase 1**: ì—ëŸ¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ í†µí•©
   - lib/utils/errors.ts ë¦¬íŒ©í† ë§
   - í…ŒìŠ¤íŠ¸

2. **Phase 2**: ì¬ì „ì†¡ API êµ¬í˜„
   - app/api/auth/resend-verification/route.ts ìƒì„±
   - í…ŒìŠ¤íŠ¸

3. **Phase 3**: UI ì—°ê²°
   - LoginForm.tsx ìˆ˜ì •
   - SignupForm.tsx ìˆ˜ì •
   - í†µí•© í…ŒìŠ¤íŠ¸

4. **Phase 4**: verify ë¼ìš°íŠ¸ ê°œì„ 
   - formatApiError ì‚¬ìš©ìœ¼ë¡œ í†µì¼
   - ìµœì¢… í…ŒìŠ¤íŠ¸

## ğŸ”— ì°¸ê³  ìë£Œ

- [Supabase Auth Error Codes](https://supabase.com/docs/guides/auth/debugging/error-codes)
- [Supabase auth.resend() Documentation](https://supabase.com/docs/reference/javascript/auth-resend)
- [Supabase Email Templates](https://supabase.com/docs/guides/auth/auth-email-templates)

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2025-01-05
**ì‘ì„±ì**: Claude Code
**ìƒíƒœ**: âœ… ê³„íš ì™„ë£Œ (êµ¬í˜„ ëŒ€ê¸°)
**êµ¬í˜„ ë°©ì‹**: Plan B - auth.resend() ë©”ì„œë“œ ì‚¬ìš©, Supabase ìì²´ rate limit í™œìš©
**ì´ë©”ì¼ í…œí”Œë¦¿**: Supabase Dashboardì—ì„œ ì´ë¯¸ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì™„ë£Œ (/api/auth/verify ì—”ë“œí¬ì¸íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)