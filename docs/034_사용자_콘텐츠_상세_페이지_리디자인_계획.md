# 사용자 콘텐츠 상세 페이지 리디자인 계획

## 문서 정보
- **작성일**: 2025-11-05
- **작성자**: Claude Code
- **관련 파일**:
  - `app/(user)/contents/[id]/page.tsx` (사용자 페이지)
  - `app/admin/contents/[id]/page.tsx` (관리자 페이지)
  - `components/admin/contents/DetectionTable.tsx`

## 1. 개요 및 목적

### 1.1 목적
사용자 콘텐츠 상세 페이지의 UI/UX를 관리자 페이지 스타일과 일치시켜 일관성 있는 사용자 경험 제공

### 1.2 변경 범위
- 레이아웃 구조 변경 (2열 그리드 레이아웃)
- 이미지 카드 스타일 통일
- 라벨/텍스트 검출 결과 카드 추가
- 발견내역 탭 → 이미지 검출 결과 테이블로 변경

### 1.3 주요 원칙
- 관리자 전용 기능(다운로드, 검토, AI 분석 요청, 새로고침) 제외
- 사용자가 볼 수 있는 정보만 표시 (admin_review_status === 'match' 항목만)
- 관리자 페이지의 디자인 시스템 재사용

---

## 2. 현재 상태 vs 목표 상태 비교

### 2.1 레이아웃 구조

#### 현재 상태
```
┌─────────────────────────────────────────────────────┐
│ Header (뒤로가기, 다운로드, 삭제)                    │
├──────────────────────┬──────────────────────────────┤
│ 좌측 컬럼             │ 우측 컬럼                     │
│                      │                              │
│ ┌──────────────────┐ │ ┌──────────────────────────┐ │
│ │ 원본 이미지       │ │ │ 감지 이미지               │ │
│ │ (aspect-video)   │ │ │ (aspect-video)           │ │
│ └──────────────────┘ │ └──────────────────────────┘ │
│                      │                              │
│ ┌──────────────────┐ │ ┌──────────────────────────┐ │
│ │ 분석결과 통합     │ │ │ 발견내역 (Tabs)           │ │
│ │ - 파일명         │ │ │ - 일치 (n건)              │ │
│ │ - 메시지         │ │ │ - 부분 일치 (n건)         │ │
│ │ - 감지된 레이블   │ │ │ - 유사 (n건)              │ │
│ │ - 감지된 텍스트   │ │ │                          │ │
│ │ - 발견 통계       │ │ │ [리스트 아이템들]         │ │
│ │   (완전/부분/유사)│ │ │                          │ │
│ └──────────────────┘ │ └──────────────────────────┘ │
└──────────────────────┴──────────────────────────────┘
```

#### 목표 상태 (관리자 페이지 스타일)
```
┌─────────────────────────────────────────────────────┐
│ Header (뒤로가기, 다운로드, 삭제)                    │
├──────────────────────┬──────────────────────────────┤
│ 좌측 컬럼             │ 우측 컬럼                     │
│                      │                              │
│ ┌──────────────────┐ │ ┌──────────────────────────┐ │
│ │ 원본 이미지       │ │ │ 발견 이미지               │ │
│ │ (aspect-[16/10]) │ │ │ (aspect-[16/10])         │ │
│ │ * 다운로드 버튼 X │ │ │ * 검토 버튼 X             │ │
│ └──────────────────┘ │ └──────────────────────────┘ │
│                      │                              │
│ ┌──────────────────┐ │ ┌──────────────────────────┐ │
│ │ 라벨 검출 결과    │ │ │ 이미지 검출 결과 (n건)    │ │
│ │ (n개)            │ │ │ * AI 분석 요청 버튼 X     │ │
│ │ * 새로고침 버튼 X │ │ │                          │ │
│ └──────────────────┘ │ │ Collapsible Sections:    │ │
│                      │ │ ▼ 완전 일치 [n건]         │ │
│ ┌──────────────────┐ │ │   Table (발견이미지,      │ │
│ │ 텍스트 검출 결과  │ │ │          페이지제목)      │ │
│ │ (n개)            │ │ │   * 검토상태 컬럼 X       │ │
│ │ * 새로고침 버튼 X │ │ │   * 작업 컬럼 X          │ │
│ └──────────────────┘ │ │                          │ │
│                      │ │ ▶ 부분 일치 [n건]         │ │
│                      │ │ ▶ 시각적 유사 [n건]       │ │
│                      │ │                          │ │
│                      │ └──────────────────────────┘ │
└──────────────────────┴──────────────────────────────┘
```

### 2.2 주요 차이점 요약

| 구분 | 현재 | 목표 |
|------|------|------|
| 그리드 레이아웃 | `lg:grid-cols-2` | `md:grid-cols-2` |
| 이미지 aspect ratio | `aspect-video` | `aspect-[16/10]` |
| 좌측 카드 구성 | 원본 이미지 + 분석결과 통합 | 원본 이미지 + 라벨 검출 + 텍스트 검출 |
| 우측 카드 구성 | 감지 이미지 + Tabs 발견내역 | 발견 이미지 + Table 이미지 검출 결과 |
| 발견내역 UI | Tabs + 카드 리스트 | Collapsible + Table |
| 클릭 동작 | 카드 전체 클릭 | 페이지 제목 클릭 |
| 배지 표시 | 탭별 개수 | 섹션별 단일 개수 |

---

## 3. 상세 구현 계획

### 3.1 이미지 카드 컴포넌트

#### 3.1.1 원본 이미지 카드
**관리자 페이지 구조** (app/admin/contents/[id]/page.tsx:192-212)
```tsx
<Card>
  <CardHeader>
    <CardTitle>원본 이미지</CardTitle>
  </CardHeader>
  <CardContent>
    <div className="relative aspect-[16/10] w-full overflow-hidden rounded-lg border bg-gray-100">
      <Image src={content.file_path} alt={content.file_name} fill className="object-contain" />
    </div>
    <div className="mt-4 flex justify-end gap-2">
      <Button variant="outline" size="sm" className="gap-1">
        <Download className="h-4 w-4" />
        다운로드
      </Button>
    </div>
  </CardContent>
</Card>
```

**사용자 페이지 적용**
- `CardHeader` + `CardTitle` 추가
- `aspect-video` → `aspect-[16/10]` 변경
- `bg-secondary-100` → `bg-gray-100` 변경
- 다운로드 버튼 섹션 **제거**

#### 3.1.2 발견 이미지 카드
**관리자 페이지 구조** (app/admin/contents/[id]/page.tsx:215-295)
```tsx
<Card ref={detectedImageCardRef}>
  <CardHeader>
    <CardTitle>발견 이미지</CardTitle>
  </CardHeader>
  <CardContent>
    <div className="relative aspect-[16/10] w-full overflow-hidden rounded-lg border bg-gray-50">
      {selectedDetection ? (
        <Image ... />
      ) : (
        <div className="flex h-full items-center justify-center p-8 text-center">
          <div>
            <FileImage className="mx-auto mb-3 h-12 w-12 text-gray-400" />
            <p className="font-medium">선택된 이미지가 없습니다</p>
            <p className="mt-1 text-sm">발견내역을 클릭하여 이미지를 확인하세요</p>
          </div>
        </div>
      )}
    </div>
    <div className="mt-4 flex justify-end gap-2">
      <Button ... disabled={!selectedDetection}>검토</Button>
    </div>
  </CardContent>
</Card>
```

**사용자 페이지 적용**
- 동일한 구조 사용
- `bg-secondary-100` → `bg-gray-50` 변경
- 검토 버튼 섹션 **제거**
- 에러 처리 로직 동일하게 적용 (imageError state)

### 3.2 좌측 컬럼 카드들

#### 3.2.1 라벨 검출 결과 카드
**관리자 페이지 구조** (app/admin/contents/[id]/page.tsx:322-355)
```tsx
<Card>
  <CardHeader className="flex flex-row items-center justify-between">
    <CardTitle>라벨 검출 결과 ({content.label_data?.labels?.length || 0}개)</CardTitle>
    {content.is_analyzed !== null && !content.is_analyzed && (
      <Button variant="ghost" size="sm" onClick={...}>
        <RefreshCw className="h-4 w-4" />
      </Button>
    )}
  </CardHeader>
  <CardContent>
    {content.label_data?.labels && content.label_data.labels.length > 0 ? (
      <div className="space-y-2">
        {content.label_data.labels.map((label, idx) => (
          <div key={idx} className="flex items-center justify-between rounded-lg border p-3">
            <span className="font-medium">{label.description}</span>
            <Badge variant="outline">{(label.score * 100).toFixed(0)}%</Badge>
          </div>
        ))}
      </div>
    ) : (
      <p className="py-8 text-center text-sm text-gray-500">검출된 라벨이 없습니다.</p>
    )}
  </CardContent>
</Card>
```

**사용자 페이지 적용**
- 동일한 구조 사용
- RefreshCw 버튼 조건부 렌더링 **전체 제거**
- 데이터는 `content.label_data` 사용 (현재 사용자 페이지의 `analysisResult.labels` 구조와 매핑 필요)

**데이터 구조 확인**:
- 사용자 페이지: `content.label_data.responses[0].labelAnnotations`
- 관리자 페이지: `content.label_data.labels`
- → **관리자 페이지와 동일한 데이터 구조 사용 (ContentDetail 타입 확인 필요)**

#### 3.2.2 텍스트 검출 결과 카드
**관리자 페이지 구조** (app/admin/contents/[id]/page.tsx:358-392)
```tsx
<Card>
  <CardHeader className="flex flex-row items-center justify-between">
    <CardTitle>텍스트 검출 결과 ({content.text_data?.words?.length || 0}개)</CardTitle>
    {content.is_analyzed !== null && !content.is_analyzed && (
      <Button variant="ghost" size="sm" onClick={...}>
        <RefreshCw className="h-4 w-4" />
      </Button>
    )}
  </CardHeader>
  <CardContent>
    {content.text_data?.words && content.text_data.words.length > 0 ? (
      <div className="rounded-lg border bg-gray-50 p-4">
        <div className="flex flex-wrap gap-2">
          {content.text_data.words.map((word, idx) => (
            <span key={idx} className="inline-block rounded border bg-white px-2 py-1 text-sm text-gray-900">
              {word}
            </span>
          ))}
        </div>
      </div>
    ) : (
      <p className="py-8 text-center text-sm text-gray-500">검출된 텍스트가 없습니다.</p>
    )}
  </CardContent>
</Card>
```

**사용자 페이지 적용**
- 동일한 구조 사용
- RefreshCw 버튼 조건부 렌더링 **전체 제거**
- 데이터는 `content.text_data` 사용

**데이터 구조 확인**:
- 사용자 페이지: `content.text_data.responses[0].textAnnotations`
- 관리자 페이지: `content.text_data.words`
- → **관리자 페이지와 동일한 데이터 구조 사용**

### 3.3 우측 이미지 검출 결과 카드

#### 3.3.1 카드 헤더
**관리자 페이지 구조** (app/admin/contents/[id]/page.tsx:299-305)
```tsx
<Card>
  <CardHeader className="flex flex-row items-center justify-between">
    <CardTitle>이미지 검출 결과 ({detections.length}건)</CardTitle>
    <Button onClick={() => setAIAnalysisModalOpen(true)} variant="outline" size="sm">
      {content.is_analyzed === null ? 'AI 분석 요청' : 'AI 분석 추가 요청'}
    </Button>
  </CardHeader>
  ...
</Card>
```

**사용자 페이지 적용**
- AI 분석 요청 버튼 **제거**
- `detections.length` → `detectedContents.length` (사용자 페이지 state 이름)

#### 3.3.2 DetectionTable 사용자 variant

**현재 DetectionTable 구조 분석**:
```tsx
// Props
interface DetectionTableProps {
  detections: DetectedContent[]
  selectedDetection: DetectedContent | null
  onDetectionClick: (detection: DetectedContent) => void
}

// 테이블 컬럼 (TableHead)
1. 발견 이미지 (TableCell: Image 12x12)
2. 페이지 제목 (TableCell: title + source_url link)
3. 검토 상태 (TableCell: getReviewStatusBadge) ← 제거 필요
4. 작업 (TableCell: "비교" Button) ← 제거 필요

// 배지 표시 (CollapsibleTrigger)
- pendingCount > 0: "n건 대기중" ← 제거 필요
- completedCount > 0: "n건 검토 완료" ← 수정 필요
```

**사용자 페이지 요구사항**:
1. **테이블 컬럼**: 발견 이미지, 페이지 제목만 유지
2. **클릭 동작**: 페이지 제목 클릭 시 `onDetectionClick` 호출
3. **배지 표시**: 섹션별 단일 개수 배지 (예: "5건")

**구현 방식 옵션**:

**옵션 A: Props에 variant 추가**
```tsx
interface DetectionTableProps {
  detections: DetectedContent[]
  selectedDetection: DetectedContent | null
  onDetectionClick: (detection: DetectedContent) => void
  variant?: 'admin' | 'user' // 추가
}
```
- 장점: 단일 컴포넌트 유지, 재사용성 높음
- 단점: 조건부 렌더링 증가

**옵션 B: 별도 UserDetectionTable 컴포넌트 생성**
```tsx
// components/user/contents/UserDetectionTable.tsx
```
- 장점: 관심사 분리, 명확한 역할
- 단점: 코드 중복 가능성

**권장 방식**: **옵션 A (variant props 추가)**
- 관리자/사용자 모두 같은 데이터 구조 사용
- 차이점은 표시 컬럼과 배지뿐
- 조건부 렌더링으로 충분히 처리 가능

#### 3.3.3 DetectionTable 수정 사항

**1. Props 인터페이스 확장**
```tsx
interface DetectionTableProps {
  detections: DetectedContent[]
  selectedDetection: DetectedContent | null
  onDetectionClick: (detection: DetectedContent) => void
  variant?: 'admin' | 'user' // 기본값: 'admin'
}
```

**2. 테이블 헤더 조건부 렌더링**
```tsx
<TableHeader>
  <TableRow>
    <TableHead className="whitespace-nowrap">발견 이미지</TableHead>
    <TableHead className="whitespace-nowrap">페이지 제목</TableHead>
    {variant === 'admin' && (
      <>
        <TableHead className="whitespace-nowrap text-right">검토 상태</TableHead>
        <TableHead className="whitespace-nowrap text-right">작업</TableHead>
      </>
    )}
  </TableRow>
</TableHeader>
```

**3. 테이블 셀 조건부 렌더링**
```tsx
<TableRow ...>
  <TableCell>
    <div className="relative h-12 w-12 overflow-hidden rounded border">
      <Image ... />
    </div>
  </TableCell>
  <TableCell
    className={`min-w-0 max-w-xs ${variant === 'user' ? 'cursor-pointer hover:bg-gray-100' : ''}`}
    onClick={variant === 'user' ? () => onDetectionClick(detection) : undefined}
  >
    <div className="flex w-full min-w-0 flex-col">
      <span className="min-w-0 truncate font-medium text-gray-900">
        {detection.page_title || '(제목 없음)'}
      </span>
      {detection.source_url && (
        <a href={detection.source_url} target="_blank" rel="noopener noreferrer" ...>
          {detection.source_url}
        </a>
      )}
    </div>
  </TableCell>
  {variant === 'admin' && (
    <>
      <TableCell className="text-right">
        {getReviewStatusBadge(detection.admin_review_status)}
      </TableCell>
      <TableCell className="text-right">
        <Button ... onClick={() => onDetectionClick(detection)}>
          비교
        </Button>
      </TableCell>
    </>
  )}
</TableRow>
```

**4. 배지 표시 조건부 렌더링**
```tsx
<CollapsibleTrigger asChild>
  <div className="flex cursor-pointer items-center justify-between ...">
    <div className="flex items-center gap-3">
      {/* 아이콘 및 라벨 */}
    </div>
    <div>
      {variant === 'admin' ? (
        <>
          {pendingCount > 0 && (
            <Badge className="bg-yellow-100 text-yellow-700 hover:bg-yellow-100">
              {pendingCount}건 대기중
            </Badge>
          )}
          {completedCount > 0 && (
            <Badge variant="outline" className="ml-2">
              {completedCount}건 검토 완료
            </Badge>
          )}
        </>
      ) : (
        <Badge variant="outline">
          {group.detections.length}건
        </Badge>
      )}
    </div>
  </div>
</CollapsibleTrigger>
```

### 3.4 데이터 타입 확인 및 매핑

#### 3.4.1 Content vs ContentDetail 타입
**확인 필요**:
- 사용자 페이지: `Content` 타입 사용 (types/index.ts)
- 관리자 페이지: `ContentDetail` 타입 사용 (types/index.ts)

**예상되는 차이점**:
- `label_data` 구조: `responses[0].labelAnnotations` vs `labels`
- `text_data` 구조: `responses[0].textAnnotations` vs `words`

**대응 방안**:
1. 사용자 페이지에서 `getContentDetail` API 사용 (관리자와 동일)
2. 또는 현재 구조 유지하고 데이터 매핑 로직 추가

#### 3.4.2 API 함수 확인
**현재**:
- 사용자: `getContent(contentId)` → Content
- 관리자: `getContentDetail(contentId)` → ContentDetail

**권장**:
- 사용자 페이지도 `getContentDetail` 사용하여 타입 통일

---

## 4. 구현 단계별 체크리스트

### Phase 1: DetectionTable 컴포넌트 수정
- [ ] `components/admin/contents/DetectionTable.tsx` 파일 열기
- [ ] Props에 `variant?: 'admin' | 'user'` 추가
- [ ] 테이블 헤더 조건부 렌더링 구현
- [ ] 테이블 셀 조건부 렌더링 구현
- [ ] 페이지 제목 클릭 이벤트 추가 (user variant)
- [ ] 배지 표시 조건부 렌더링 구현

### Phase 2: 사용자 페이지 데이터 구조 변경
- [ ] types/index.ts에서 Content, ContentDetail 타입 확인
- [ ] `getContent` → `getContentDetail` 변경 검토
- [ ] label_data, text_data 구조 확인 및 매핑

### Phase 3: 사용자 페이지 레이아웃 재구성
- [ ] 그리드 레이아웃 변경: `lg:grid-cols-2` → `md:grid-cols-2`
- [ ] 좌측 컬럼 구조 변경
  - [ ] 원본 이미지 카드 수정 (aspect-ratio, 다운로드 버튼 제거)
  - [ ] 라벨 검출 결과 카드 추가
  - [ ] 텍스트 검출 결과 카드 추가
- [ ] 우측 컬럼 구조 변경
  - [ ] 발견 이미지 카드 수정 (검토 버튼 제거)
  - [ ] 발견내역 Tabs → DetectionTable로 대체
  - [ ] DetectionTable variant='user' 적용

### Phase 4: 불필요한 코드 제거
- [ ] analysisResult 파생 로직 제거 (39-69번 라인)
- [ ] groupedDetections 로직 제거 (177-182번 라인)
- [ ] Tabs 컴포넌트 import 제거
- [ ] Tabs 관련 JSX 제거 (330-474번 라인)

### Phase 5: Import 정리
- [ ] Card, CardContent, CardHeader, CardTitle import 추가
- [ ] Tabs 관련 import 제거
- [ ] RefreshCw icon 필요 없음 확인

### Phase 6: 스타일 및 반응형 검증
- [ ] 데스크톱 뷰 테스트 (1920x1080)
- [ ] 태블릿 뷰 테스트 (768x1024)
- [ ] 모바일 뷰 테스트 (375x667)
- [ ] 이미지 로딩 상태 확인
- [ ] 에러 상태 UI 확인

### Phase 7: 기능 테스트
- [ ] 페이지 로딩 시 데이터 fetch 확인
- [ ] 라벨 검출 결과 표시 확인
- [ ] 텍스트 검출 결과 표시 확인
- [ ] DetectionTable 섹션 토글 동작 확인
- [ ] 페이지 제목 클릭 시 이미지 표시 확인
- [ ] 이미지 에러 처리 확인
- [ ] 빈 데이터 상태 UI 확인

---

## 5. 예상되는 이슈 및 대응 방안

### 5.1 데이터 타입 불일치
**이슈**: Content와 ContentDetail 타입 차이로 인한 오류
**대응**:
- `getContentDetail` API 사용으로 통일
- 타입 확인 후 필요시 타입 가드 추가

### 5.2 DetectionTable 재사용성
**이슈**: variant 추가로 인한 복잡도 증가
**대응**:
- 조건부 렌더링을 명확하게 구조화
- 필요시 추후 분리 고려

### 5.3 반응형 레이아웃
**이슈**: md 브레이크포인트(768px)에서 2열 레이아웃이 좁을 수 있음
**대응**:
- 실제 테스트 후 필요시 lg 브레이크포인트 유지 검토

### 5.4 페이지 제목 클릭 vs URL 클릭
**이슈**: 페이지 제목 영역에 URL 링크가 포함되어 이벤트 충돌 가능
**대응**:
- URL 링크에 `onClick={(e) => e.stopPropagation()}` 추가 (이미 구현됨)
- 페이지 제목 span에만 클릭 이벤트 적용

### 5.5 기존 기능 호환성
**이슈**: ImageViewer, ConfirmDialog 등 기존 컴포넌트 동작 유지
**대응**:
- 기존 컴포넌트는 그대로 유지
- 레이아웃만 변경

---

## 6. 테스트 시나리오

### 6.1 정상 데이터 시나리오
**Given**: 분석이 완료되고 match 상태의 detection이 있는 콘텐츠
**When**: 페이지 접속
**Then**:
- 원본 이미지 표시
- 라벨 검출 결과 카드에 레이블 목록 표시
- 텍스트 검출 결과 카드에 단어 목록 표시
- 이미지 검출 결과 카드에 섹션별 항목 표시
- 페이지 제목 클릭 시 발견 이미지 표시

### 6.2 빈 데이터 시나리오
**Given**: 분석 결과가 없거나 detection이 없는 콘텐츠
**When**: 페이지 접속
**Then**:
- "검출된 라벨이 없습니다" 메시지 표시
- "검출된 텍스트가 없습니다" 메시지 표시
- "검출된 이미지가 없습니다" 메시지 표시

### 6.3 이미지 로딩 에러 시나리오
**Given**: 발견 이미지 URL이 잘못된 경우
**When**: 페이지 제목 클릭
**Then**:
- "이미지를 출력할 수 없습니다" 메시지 표시
- 원본 이미지 링크, 페이지 방문 버튼 표시

### 6.4 반응형 시나리오
**Given**: 다양한 화면 크기
**When**: 페이지 접속
**Then**:
- 768px 이상: 2열 그리드 레이아웃
- 768px 미만: 1열 세로 레이아웃
- 모든 카드가 적절히 표시됨

### 6.5 Collapsible 토글 시나리오
**Given**: 이미지 검출 결과가 여러 섹션에 있음
**When**: 섹션 헤더 클릭
**Then**:
- 해당 섹션 펼침/접힘 토글
- 다른 섹션 상태는 유지

---

## 7. 마일스톤 및 일정

### M1: DetectionTable 수정 (1일)
- variant props 추가
- 조건부 렌더링 구현
- 단위 테스트

### M2: 사용자 페이지 레이아웃 변경 (1일)
- 좌측 컬럼 재구성
- 우측 컬럼 재구성
- 불필요한 코드 제거

### M3: 통합 테스트 및 QA (0.5일)
- 기능 테스트
- 반응형 테스트
- 버그 수정

**총 예상 기간**: 2.5일

---

## 8. 참고 자료

### 8.1 관련 파일
- `app/(user)/contents/[id]/page.tsx` - 사용자 콘텐츠 상세 페이지
- `app/admin/contents/[id]/page.tsx` - 관리자 콘텐츠 상세 페이지
- `components/admin/contents/DetectionTable.tsx` - Detection 테이블 컴포넌트
- `lib/api/contents.ts` - Content API 함수들
- `types/index.ts` - Content, ContentDetail 타입 정의

### 8.2 관련 이슈
- (이슈 번호가 있다면 링크 추가)

### 8.3 디자인 시스템
- shadcn/ui 컴포넌트 사용
- Tailwind CSS 유틸리티 클래스

---

## 9. 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-11-05 | 1.0 | 초안 작성 | Claude Code |

---

## 10. 승인 및 리뷰

- [ ] 기획 검토
- [ ] 디자인 검토
- [ ] 개발 리드 승인
- [ ] QA 팀 확인
